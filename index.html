<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è¤‡ç·šå›³ãƒ¢ãƒ¼ãƒ‰ - æœ¬ç‰©åˆ¤å®š</title>

<style>
body{
  text-align:center;
  font-family:sans-serif;
  background:#f0f0f0;
  margin:0;
}

#board{
  width:360px;
  height:500px;
  margin:20px auto;
  background:white;
  border:2px solid black;
  position:relative;
}

.node{
  width:80px;
  height:40px;
  border:2px solid black;
  text-align:center;
  line-height:40px;
  position:absolute;
  background:#ddd;
}

.terminal{
  width:18px;
  height:18px;
  border-radius:50%;
  background:black;
  position:absolute;
  cursor:pointer;
}

.jb{
  width:120px;
  height:120px;
  border:3px solid #333;
  position:absolute;
  top:190px;
  left:120px;
  background:#fafafa;
}

.line{
  position:absolute;
  background:black;
  height:3px;
  transform-origin:0 0;
}

.selected{
  background:red !important;
}

#score{
  font-size:18px;
}

#message{
  font-size:20px;
  font-weight:bold;
}
</style>
</head>

<body>

<h2>âš¡ è¤‡ç·šå›³ãƒ¢ãƒ¼ãƒ‰ - æœ¬ç‰©åˆ¤å®šç‰ˆ</h2>

<div id="board">

  <div class="node" style="top:40px; left:20px;">é›»æº</div>
  <div class="terminal" data-id="L" style="top:90px; left:50px;"></div>
  <div class="terminal" data-id="N" style="top:120px; left:50px;"></div>

  <div class="node" style="top:40px; left:250px;">SW</div>
  <div class="terminal" data-id="SW1" style="top:90px; left:280px;"></div>
  <div class="terminal" data-id="SW2" style="top:120px; left:280px;"></div>

  <div class="node" style="top:400px; left:140px;">ãƒ©ãƒ³ãƒ—</div>
  <div class="terminal" data-id="Lamp1" style="top:360px; left:165px;"></div>
  <div class="terminal" data-id="Lamp2" style="top:360px; left:195px;"></div>

  <div class="jb"></div>

  <div class="terminal" data-id="JB1" style="top:210px; left:140px;"></div>
  <div class="terminal" data-id="JB2" style="top:210px; left:190px;"></div>
  <div class="terminal" data-id="JB3" style="top:210px; left:240px;"></div>

  <div class="terminal" data-id="JB4" style="top:260px; left:140px;"></div>
  <div class="terminal" data-id="JB5" style="top:260px; left:190px;"></div>
  <div class="terminal" data-id="JB6" style="top:260px; left:240px;"></div>

</div>

<div id="score">ã‚¹ã‚³ã‚¢: 10000</div>
<div id="message"></div>
<button onclick="resetGame()">ãƒªã‚»ãƒƒãƒˆ</button>

<script>

let selected=null;
let score=10000;

const board=document.getElementById("board");
const scoreDisplay=document.getElementById("score");
const message=document.getElementById("message");

let parent={};

function find(x){
  if(parent[x]!==x){
    parent[x]=find(parent[x]);
  }
  return parent[x];
}

function union(a,b){
  let pa=find(a);
  let pb=find(b);
  if(pa!==pb){
    parent[pb]=pa;
  }
}

function init(){
  parent={};
  document.querySelectorAll(".terminal").forEach(t=>{
    parent[t.dataset.id]=t.dataset.id;
  });
}

init();

document.querySelectorAll(".terminal").forEach(t=>{
  t.addEventListener("click",()=>handleClick(t));
});

function handleClick(t){
  if(!selected){
    selected=t;
    t.classList.add("selected");
  }else{
    if(selected===t) return;
    createLine(selected,t);
    union(selected.dataset.id,t.dataset.id);
    selected.classList.remove("selected");
    selected=null;
    checkAnswer();
  }
}

function createLine(a,b){
  let ra=a.getBoundingClientRect();
  let rb=b.getBoundingClientRect();
  let rbBoard=board.getBoundingClientRect();

  let x1=ra.left-rbBoard.left+9;
  let y1=ra.top-rbBoard.top+9;
  let x2=rb.left-rbBoard.left+9;
  let y2=rb.top-rbBoard.top+9;

  let len=Math.hypot(x2-x1,y2-y1);

  let line=document.createElement("div");
  line.className="line";
  line.style.left=x1+"px";
  line.style.top=y1+"px";
  line.style.width=len+"px";
  line.style.transform="rotate("+Math.atan2(y2-y1,x2-x1)+"rad)";
  board.appendChild(line);
}

function same(a,b){
  return find(a)===find(b);
}

function checkAnswer(){
  if(
    same("L","SW1") &&
    same("SW2","Lamp1") &&
    same("N","Lamp2")
  ){
    message.innerText="ğŸ’¡ æ­£è§£ï¼ãƒ©ãƒ³ãƒ—ç‚¹ç¯ï¼";
  }
}

function resetGame(){
  document.querySelectorAll(".line").forEach(l=>l.remove());
  score=10000;
  scoreDisplay.innerText="ã‚¹ã‚³ã‚¢: 10000";
  message.innerText="";
  init();
}

</script>

</body>
</html>
