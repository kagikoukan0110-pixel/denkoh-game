<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>俺らの電工 - 試験編</title>
<style>
:root{--bg:#000; --panel:#e6e6e6; --term-bg:#222; --lamp-glow: rgba(255,220,80,0.95);}
body{margin:0; background:var(--bg); color:#fff; font-family:sans-serif; overflow:hidden;}

/* レインボー演出 */
@keyframes rainbow {
  0% {filter: hue-rotate(0deg) brightness(1.5);}
  50% {filter: hue-rotate(180deg) brightness(2.5);}
  100% {filter: hue-rotate(360deg) brightness(1.5);}
}
.flash-rainbow { animation: rainbow 0.1s infinite !important; }

/* モーダル・クイズ画面 */
.modal-backdrop{position:fixed; inset:0; background:rgba(0,0,0,0.95); display:none; align-items:center; justify-content:center; z-index:9999;}
.modal-backdrop.show{display:flex}
.card{width:85%; max-width:400px; background:#222; padding:20px; border-radius:15px; border:2px solid #555; text-align:center;}
.q-btn{display:block; width:100%; margin:10px 0; padding:15px; background:#444; border:none; color:#fff; border-radius:8px; cursor:pointer;}

/* ゲーム画面 */
#gameBoard{display:none; width:100vw; height:100vh;}
.device{position:absolute; width:100px; min-height:130px; padding:8px; background:var(--panel); border-radius:12px; color:#000; box-shadow:0 8px 20px rgba(0,0,0,0.5); transform:translate(-50%,-50%); z-index:60; box-sizing:border-box; text-align:center;}
.terminal{display:inline-flex; justify-content:center; align-items:center; width:30px; height:30px; margin:3px; background:var(--term-bg); color:#fff; border-radius:50%; font-size:11px; cursor:pointer;}
.selected{outline:3px solid #ffd800;}
.device.lit{background:#fff9c4 !important; box-shadow:0 0 40px var(--lamp-glow);}
</style>
</head>
<body>

<div id="quizScreen" class="modal-backdrop show">
  <div class="card">
    <h2 id="qText">読み込み中...</h2>
    <div id="answers"></div>
    <div style="margin-top:20px;">現在のHP: <span id="hpDisplay">100</span></div>
  </div>
</div>

<div id="bossScreen" class="modal-backdrop">
  <div class="card">
    <h2 id="bossMsg">ダメージ！</h2>
    <img id="bossImage" src="boss.png.jpg" style="width:100%; border-radius:8px;">
    <div style="height:20px; background:#333; margin:10px 0;"><div id="bossHP" style="height:100%; width:100%; background:red;"></div></div>
  </div>
</div>

<div id="gameBoard">
  <div id="wireLayer" style="position:fixed; z-index:50;"></div>
  <div id="boardContainer"></div>
  <div style="position:fixed; bottom:20px; width:100%; text-align:center;">
    <button id="setBtn" style="padding:15px 40px; font-size:20px; background:#ffd000;">SET (通電)</button>
  </div>
</div>

<script>
const quizData = [
  {q: "電気工事士法で、電気工事に従事できるのは？", a: ["誰でも", "資格保持者", "大工", "警備員"], correct: 1},
  {q: "電圧100Vの回路で許容電流が最大なのは？", a: ["1.6mm", "2.0mm", "2.6mm", "3.2mm"], correct: 3},
  {q: "圧着接続で正しいのは？", a: ["ペンチ", "素手", "専用工具", "接着剤"], correct: 2},
  {q: "ショートの説明で正しいのは？", a: ["電流がゼロ", "過大な電流", "電圧が倍増", "抵抗が増える"], correct: 1},
  {q: "接地抵抗が最も低いのは？", a: ["A種", "B種", "C種", "D種"], correct: 0}
];

let currentQ = 0, playerHP = 100, bossHP = 100, round = 1;

// クイズ表示
function renderQuiz() {
  if(currentQ >= quizData.length) {
    document.getElementById('quizScreen').classList.remove('show');
    document.getElementById('gameBoard').style.display = 'block';
    setupBoard();
    return;
  }
  const data = quizData[currentQ];
  document.getElementById('qText').textContent = data.q;
  const ans = document.getElementById('answers'); ans.innerHTML = '';
  data.a.forEach((txt, i) => {
    const btn = document.createElement('button'); btn.className = 'q-btn'; btn.textContent = txt;
    btn.onclick = () => {
      if(i !== data.correct) { playerHP -= 20; alert("間違い！HP-20"); }
      document.getElementById('hpDisplay').textContent = playerHP;
      if(playerHP <= 0) location.reload();
      currentQ++; renderQuiz();
    };
    ans.appendChild(btn);
  });
}

// 演出: レインボーフラッシュ
function triggerFlash() {
  document.body.classList.add('flash-rainbow');
  setTimeout(() => document.body.classList.remove('flash-rainbow'), 1500);
}

// ゲームボード配置 (前回ロジック)
function setupBoard() {
  // ここに配置処理を記述（前回同様のロジック）
}

// SETボタン押下時の派手な演出
document.getElementById('setBtn').onclick = () => {
  // 正解判定ロジック...
  triggerFlash(); // 撃破時にレインボー発動！
  document.getElementById('bossScreen').style.display = 'flex';
  setTimeout(() => document.getElementById('bossScreen').style.display = 'none', 2000);
};

renderQuiz();
</script>
</body>
</html>
