<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä¸‰è·¯ãƒ†ã‚¹ãƒˆç‰ˆï¼ˆæœ¬ç‰©ã‚¨ãƒ³ã‚¸ãƒ³ï¼‰</title>

<style>
body{
  font-family:sans-serif;
  text-align:center;
  background:#f2f2f2;
  margin:0;
}

#field{
  width:360px;
  height:520px;
  margin:20px auto;
  border:3px solid black;
  position:relative;
  background:white;
}

.node{
  width:22px;
  height:22px;
  border-radius:50%;
  background:black;
  position:absolute;
}

.label{
  position:absolute;
  font-size:14px;
  font-weight:bold;
}

button{
  margin:6px;
  padding:8px 14px;
}

#lineLayer{
  position:absolute;
  width:100%;
  height:100%;
  pointer-events:none;
}

#msg{
  margin-top:10px;
  font-weight:bold;
  white-space:pre-line;
}
</style>
</head>
<body>

<h2>âš¡ ä¸‰è·¯ãƒ†ã‚¹ãƒˆï¼ˆæœ¬ç‰©åˆ¤å®šï¼‰</h2>

<div id="field">
  <canvas id="lineLayer"></canvas>

  <!-- é›»æº -->
  <div class="label" style="left:30px;top:20px;">é›»æº</div>
  <div class="node" id="L" style="left:60px;top:50px;"></div>
  <div class="node" id="N" style="left:60px;top:90px;background:white;border:2px solid black;"></div>

  <!-- SW1 -->
  <div class="label" style="left:220px;top:20px;">ä¸‰è·¯SW1</div>
  <div class="node" id="S1C" style="left:250px;top:50px;"></div>
  <div class="node" id="S1T1" style="left:220px;top:90px;"></div>
  <div class="node" id="S1T2" style="left:280px;top:90px;"></div>

  <!-- SW2 -->
  <div class="label" style="left:220px;top:180px;">ä¸‰è·¯SW2</div>
  <div class="node" id="S2C" style="left:250px;top:210px;"></div>
  <div class="node" id="S2T1" style="left:220px;top:250px;"></div>
  <div class="node" id="S2T2" style="left:280px;top:250px;"></div>

  <!-- ãƒ©ãƒ³ãƒ— -->
  <div class="label" style="left:140px;top:380px;">ãƒ©ãƒ³ãƒ—</div>
  <div class="node" id="Lamp1" style="left:150px;top:410px;"></div>
  <div class="node" id="Lamp2" style="left:200px;top:410px;background:white;border:2px solid black;"></div>

</div>

<button onclick="toggle('S1')">SW1åˆ‡æ›¿</button>
<button onclick="toggle('S2')">SW2åˆ‡æ›¿</button>
<button onclick="analyze()">è§£æ</button>
<button onclick="reset()">ãƒªã‚»ãƒƒãƒˆ</button>

<div id="msg"></div>

<script>

// ===== ã‚°ãƒ©ãƒ•å›è·¯ã‚¨ãƒ³ã‚¸ãƒ³ =====

class Circuit{
  constructor(){
    this.nodes=new Set();
    this.edges={};
  }
  addNode(n){
    this.nodes.add(n);
    if(!this.edges[n]) this.edges[n]=[];
  }
  addEdge(a,b){
    this.edges[a].push(b);
    this.edges[b].push(a);
  }
  dfs(start){
    let visited=new Set();
    let stack=[start];
    while(stack.length){
      let n=stack.pop();
      if(!visited.has(n)){
        visited.add(n);
        this.edges[n].forEach(x=>stack.push(x));
      }
    }
    return visited;
  }
}

// ===== ã‚¹ã‚¤ãƒƒãƒçŠ¶æ…‹ =====

let switches={
  S1:{pos:0},
  S2:{pos:0}
};

// ===== ãƒ¦ãƒ¼ã‚¶ãƒ¼é…ç·šï¼ˆå›ºå®šä¾‹ï¼‰ =====

let baseConnections=[
  ["L","S1C"],
  ["S1T1","S2T1"],
  ["S1T2","S2T2"],
  ["S2C","Lamp1"],
  ["Lamp2","N"]
];

// ===== å›è·¯æ§‹ç¯‰ =====

function buildCircuit(){

  let c=new Circuit();

  // ãƒãƒ¼ãƒ‰ç™»éŒ²
  document.querySelectorAll(".node").forEach(n=>{
    c.addNode(n.id);
  });

  // å›ºå®šé…ç·š
  baseConnections.forEach(pair=>{
    c.addEdge(pair[0],pair[1]);
  });

  // ä¸‰è·¯å†…éƒ¨
  if(switches.S1.pos===0){
    c.addEdge("S1C","S1T1");
  }else{
    c.addEdge("S1C","S1T2");
  }

  if(switches.S2.pos===0){
    c.addEdge("S2C","S2T1");
  }else{
    c.addEdge("S2C","S2T2");
  }

  return c;
}

// ===== è§£æ =====

function analyze(){

  let c=buildCircuit();

  let visited=c.dfs("L");

  let lampSide=c.dfs("Lamp2");

  if(visited.has("Lamp1") && lampSide.has("N")){
    show("ğŸ’¡ ãƒ©ãƒ³ãƒ—ç‚¹ç¯\nï¼ˆè«–ç†æˆç«‹ï¼‰");
  }else{
    show("âŒ å›è·¯ä¸æˆç«‹");
  }
}

// ===== åˆ‡æ›¿ =====

function toggle(name){
  switches[name].pos=1-switches[name].pos;
  show(name+" â†’ "+switches[name].pos);
}

// ===== è¡¨ç¤º =====

function show(msg){
  document.getElementById("msg").innerText=msg;
}

function reset(){
  switches.S1.pos=0;
  switches.S2.pos=0;
  show("ãƒªã‚»ãƒƒãƒˆå®Œäº†");
}

</script>

</body>
</html>
