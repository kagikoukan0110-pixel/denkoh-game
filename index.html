<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä¸‰è·¯å››è·¯ã‚¨ãƒ³ã‚¸ãƒ³åŸºç¤ç‰ˆ</title>
<style>
body{font-family:sans-serif;text-align:center;background:#f2f2f2;}
button{margin:5px;padding:8px 14px;}
#msg{white-space:pre-line;font-weight:bold;margin-top:10px;}
</style>
</head>
<body>

<h2>âš¡ ä¸‰è·¯ï¼‹å››è·¯ å…±é€šã‚¨ãƒ³ã‚¸ãƒ³</h2>

<button onclick="toggle('S1')">ä¸‰è·¯SW1åˆ‡æ›¿</button>
<button onclick="toggle('S2')">ä¸‰è·¯SW2åˆ‡æ›¿</button>
<button onclick="analyze()">è§£æ</button>

<div id="msg"></div>

<script>

// ===== å›è·¯ã‚¨ãƒ³ã‚¸ãƒ³ =====

class Circuit{
  constructor(){
    this.nodes = new Set();
    this.edges = {};
  }

  addNode(n){
    this.nodes.add(n);
    if(!this.edges[n]) this.edges[n]=[];
  }

  addEdge(a,b){
    this.edges[a].push(b);
    this.edges[b].push(a);
  }

  dfs(start){
    let visited = new Set();
    let stack=[start];

    while(stack.length){
      let n=stack.pop();
      if(!visited.has(n)){
        visited.add(n);
        this.edges[n].forEach(x=>stack.push(x));
      }
    }
    return visited;
  }
}

// ===== ã‚¹ã‚¤ãƒƒãƒå®šç¾© =====

let switches = {
  S1:{
    type:"3way",
    pos:0,
    terminals:{
      C:"S1C",
      T1:"S1T1",
      T2:"S1T2"
    }
  },
  S2:{
    type:"3way",
    pos:0,
    terminals:{
      C:"S2C",
      T1:"S2T1",
      T2:"S2T2"
    }
  }
};

// ===== å›ºå®šé…ç·šï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼é…ç·šã¨æƒ³å®šï¼‰ =====

function buildBaseCircuit(){

  let c = new Circuit();

  // ãƒãƒ¼ãƒ‰ç™»éŒ²
  [
    "L","N",
    "S1C","S1T1","S1T2",
    "S2C","S2T1","S2T2",
    "Lamp1","Lamp2"
  ].forEach(n=>c.addNode(n));

  // ===== é…ç·šï¼ˆä¾‹ï¼šæ­£ã—ã„ä¸‰è·¯é…ç·šï¼‰ =====

  c.addEdge("L","S1C");

  c.addEdge("S1T1","S2T1");
  c.addEdge("S1T2","S2T2");

  c.addEdge("S2C","Lamp1");
  c.addEdge("Lamp2","N");

  return c;
}

// ===== ã‚¹ã‚¤ãƒƒãƒå†…éƒ¨é©ç”¨ =====

function applySwitches(c){

  Object.values(switches).forEach(sw=>{

    if(sw.type==="3way"){

      if(sw.pos===0){
        c.addEdge(sw.terminals.C, sw.terminals.T1);
      }else{
        c.addEdge(sw.terminals.C, sw.terminals.T2);
      }
    }

    if(sw.type==="4way"){

      if(sw.pos===0){
        c.addEdge(sw.terminals.T1, sw.terminals.T3);
        c.addEdge(sw.terminals.T2, sw.terminals.T4);
      }else{
        c.addEdge(sw.terminals.T1, sw.terminals.T4);
        c.addEdge(sw.terminals.T2, sw.terminals.T3);
      }
    }

  });

}

// ===== è§£æ =====

function analyze(){

  let circuit = buildBaseCircuit();

  applySwitches(circuit);

  let visited = circuit.dfs("L");

  if(visited.has("Lamp1") && circuit.dfs("Lamp2").has("N")){
    show("ğŸ’¡ ãƒ©ãƒ³ãƒ—ç‚¹ç¯");
  }else{
    show("âŒ ä¸æˆç«‹");
  }
}

function toggle(name){
  switches[name].pos = 1 - switches[name].pos;
  show(name+" ä½ç½®ï¼š"+switches[name].pos);
}

function show(msg){
  document.getElementById("msg").innerText=msg;
}

</script>

</body>
</html>
