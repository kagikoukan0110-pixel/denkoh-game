<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>‰ø∫„Çâ„ÅÆÈõªÂ∑• - GOD CONNECTION (ULTIMATE)</title>
<style>
:root { --neon: #ffd000; --red: #ff3333; --panel: #e0e0e0; --bg: #000; }
html, body { height: 100%; margin: 0; background: var(--bg); color: #fff; font-family: 'Arial Black', sans-serif; overflow: hidden; touch-action: none; }

/* --- ÊºîÂá∫Áî®„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ --- */
@keyframes shake { 0% { transform: translate(0,0); } 10% { transform: translate(-10px, -10px); } 30% { transform: translate(10px, 10px); } 50% { transform: translate(-10px, 10px); } 70% { transform: translate(10px, -10px); } 100% { transform: translate(0,0); } }
.shake { animation: shake 0.4s ease-in-out; }
.hit-flash { position: fixed; inset: 0; background: rgba(255,0,0,0.4); z-index: 40000; display: none; pointer-events: none; }

/* --- „Çø„Ç§„Éà„É´ÁîªÈù¢ --- */
#titleScreen { position: fixed; inset: 0; background: #000; z-index: 50000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
.title-logo { font-size: 52px; font-weight: 900; color: var(--neon); text-shadow: 0 0 20px var(--neon); margin: 0; }
.start-btn { margin-top: 40px; padding: 20px 80px; font-size: 24px; font-weight: bold; background: var(--neon); border: none; border-radius: 60px; cursor: pointer; box-shadow: 0 0 30px var(--neon); }

/* --- „Éú„Çπ (IMG_2188ÂÜçÁèæ) --- */
#bossContainer { position: absolute; top: 15%; left: 50%; transform: translateX(-50%); text-align: center; z-index: 5; transition: 0.3s; }
.boss-img { font-size: 150px; filter: drop-shadow(0 0 20px red); opacity: 0.8; }
.boss-name { color: var(--red); font-weight: 900; font-size: 24px; text-shadow: 0 0 10px #000; }

/* --- HP„Éê„Éº --- */
.hp-container { position: fixed; top: 15px; width: 100%; display: flex; justify-content: space-around; z-index: 20000; }
.hp-box { width: 42%; }
.hp-bar-bg { height: 16px; background: #222; border-radius: 8px; border: 2px solid #555; overflow: hidden; }
.hp-bar-fill { height: 100%; width: 100%; transition: width 0.6s cubic-bezier(0.17, 0.67, 0.83, 0.67); }
#playerHPBar { background: linear-gradient(90deg, #00d2ff, #3a7bd5); }
#bossHPBar { background: linear-gradient(90deg, #ff0000, #b21f1f); }

/* --- „Éá„Éê„Ç§„Çπ (IMG_2186ÂÜçÁèæ) --- */
.device { position: absolute; width: 100px; background: var(--panel); border: 3px solid #666; border-radius: 10px; color: #000; transform: translate(-50%, -50%); z-index: 1000; padding: 10px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.8); }
.device h3 { margin: 0 0 8px; font-size: 12px; border-bottom: 2px solid #999; }
.icon-lp { width: 36px; height: 36px; border: 3px solid #444; border-radius: 50%; margin: 5px auto; display: flex; align-items: center; justify-content: center; font-size: 22px; font-weight: bold; }
.icon-brk { width: 35px; height: 40px; background: #222; margin: 0 auto; border: 2px solid #000; position: relative; }
.icon-brk::after { content: 'L/N'; color: #fff; font-size: 9px; }

.t-row { display: flex; justify-content: space-around; margin-top: 10px; }
.term { width: 28px; height: 28px; background: #111; color: #fff; border-radius: 50%; font-size: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 2px solid #444; position: relative; z-index: 1100; }
.sel { background: #ff0000; box-shadow: 0 0 15px #ff0000; transform: scale(1.2); border-color: #fff; }

/* --- ÈÖçÁ∑ö --- */
#wireLayer { position: fixed; inset: 0; pointer-events: none; z-index: 8000; }
.wire-path { fill: none; stroke-width: 10; stroke-linecap: round; }
.wire-black { stroke: #111; }
.wire-white { stroke: #fff; }
.wire-glow { stroke: var(--neon); stroke-width: 6; stroke-dasharray: 10, 20; animation: flow 0.4s linear infinite; display: none; }
@keyframes flow { from { stroke-dashoffset: 30; } to { stroke-dashoffset: 0; } }

/* --- „ÇØ„Ç§„Ç∫ (4Êäû) --- */
.modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 30000; display: none; align-items: center; justify-content: center; }
.card { width: 90%; max-width: 380px; background: #1a1a1a; padding: 30px; border-radius: 20px; border: 2px solid var(--neon); text-align: center; }
.ans-btn { display:block; width:100%; margin:12px 0; padding:18px; background:#333; color:#fff; border:1px solid #555; border-radius:12px; font-size: 16px; font-weight: bold; }
.ans-btn:active { background: var(--neon); color: #000; }

.controls { position: fixed; bottom: 0; width: 100%; padding: 25px 0; background: #111; display: none; flex-direction: column; align-items: center; z-index: 20000; border-top: 4px solid #333; }
#setBtn { padding: 18px 100px; background: var(--neon); color: #000; border: none; border-radius: 50px; font-weight: 900; font-size: 24px; box-shadow: 0 6px 0 #b29200; }
#setBtn:active { transform: translateY(4px); box-shadow: none; }
</style>
</head>
<body id="mainBody">

<div id="hitFlash" class="hit-flash"></div>

<div id="titleScreen">
    <div class="title-logo">‰ø∫„Çâ„ÅÆÈõªÂ∑•</div>
    <div style="color:red; font-weight:bold; letter-spacing:4px;">GOD CONNECTION</div>
    <button class="start-btn" onclick="gameStart()">ÁèæÂ†¥ÂÖ•„Çä</button>
</div>

<div class="hp-container" id="hpUI" style="display:none;">
    <div class="hp-box">
        <div style="font-size:14px; font-weight:bold;">ÊñΩÂ∑•‰∏ª HP</div>
        <div class="hp-bar-bg"><div id="playerHPBar" class="hp-bar-fill"></div></div>
    </div>
    <div class="hp-box">
        <div style="font-size:14px; font-weight:bold; color:red;">BOSS HP</div>
        <div class="hp-bar-bg"><div id="bossHPBar" class="hp-bar-fill"></div></div>
    </div>
</div>

<div id="bossContainer" style="display:none;">
    <div class="boss-name">È´òÈõªÂúßÈ≠îÁ•û„Éª„Ç¢„Éº„ÇØ</div>
    <div class="boss-img">üë∫</div>
</div>

<svg id="wireLayer"></svg>

<div id="quizScreen" class="modal">
    <div class="card">
        <h2 style="color:var(--neon); margin:0;">Â≠¶ÁßëË©¶È®ì</h2>
        <p id="qText" style="margin:25px 0; font-size:18px; line-height:1.5;"></p>
        <div id="ansBox"></div>
    </div>
</div>

<div id="board" style="position:relative; width:100%; height:100%; display:none;"></div>

<div class="controls" id="ui">
    <div style="margin-bottom:15px; display:flex; gap:15px;">
        <button id="swToggle" onclick="toggleSW()" style="padding:12px 25px; background:#444; color:#fff; border:none; border-radius:8px; font-weight:bold;">„Çπ„Ç§„ÉÉ„ÉÅ: OFF</button>
        <button onclick="resetWires()" style="padding:12px 25px; background:#444; color:#fff; border:none; border-radius:8px; font-weight:bold;">„É™„Çª„ÉÉ„Éà</button>
    </div>
    <button id="setBtn" onclick="checkCircuit()">SET (ÈÄöÈõªÈñãÂßã)</button>
</div>

<script>
const quizzes = [
    {q:"Êé•Âú∞ÂÅ¥ÔºàÁôΩÁ∑öÔºâ„ÇíÁπã„Åê„Åπ„ÅçÁ´ØÂ≠êË®òÂè∑„ÅØÔºü", a:["L","W (N)","E","S"], c:1},
    {q:"ÈõªÂúßÂÅ¥ÔºàÈªíÁ∑öÔºâ„Çí„Çπ„Ç§„ÉÉ„ÉÅ„Å´ÂÖ•„Çå„ÇãÁêÜÁî±„ÅØÔºü", a:["ÈõªÂúß„ÇíÂàá„Çã„Åü„ÇÅ","Ëâ≤„ÇíÂêà„Çè„Åõ„Çã„Åü„ÇÅ","ÈõªÊ∞ó„ÇíË≤Ø„ÇÅ„Çã„Åü„ÇÅ","Áâπ„Å´ÁêÜÁî±„ÅØ„Å™„ÅÑ"], c:0},
    {q:"ÂõûË∑ØÂõ≥„Åß„Äé‚óè„Äè„ÅÆ‰∏≠„Å´„ÄéL„Äè„Å®Êõ∏„ÅÑ„Å¶„ÅÇ„Çã„ÇÇ„ÅÆ„ÅØÔºü", a:["„Ç≥„É≥„Çª„É≥„Éà","Á¢∫Ë™çË°®Á§∫ÁÅØ","‰ΩçÁΩÆË°®Á§∫ÁÅØ","„Éë„Ç§„É≠„ÉÉ„Éà„É©„É≥„Éó"], c:2},
    {q:"Áµ∂Á∏ÅÊäµÊäó„ÅÆÊ∏¨ÂÆö„Å´‰ΩøÁî®„Åô„ÇãÂô®ÂÖ∑„ÅØÔºü", a:["„ÉÜ„Çπ„Çø","„ÇØ„É©„É≥„Éó„É°„Éº„Çø","„É°„Ç¨„Éº","Ê§úÈõªÂô®"], c:2}
];

let pHP = 100, bHP = 100, qIdx = 0, lines = [], selTerm = null, swOn = false;

function gameStart() {
    document.getElementById('titleScreen').style.display = 'none';
    nextQuiz();
}

function nextQuiz() {
    if(qIdx >= quizzes.length) {
        document.getElementById('quizScreen').style.display = 'none';
        initBoard();
        return;
    }
    const q = quizzes[qIdx];
    document.getElementById('quizScreen').style.display = 'flex';
    document.getElementById('qText').innerText = q.q;
    const box = document.getElementById('ansBox'); box.innerHTML = '';
    q.a.forEach((txt, i) => {
        const btn = document.createElement('button');
        btn.className = 'ans-btn'; btn.innerText = txt;
        btn.onclick = () => {
            if(i === q.c) { qIdx++; nextQuiz(); }
            else { damagePlayer(25); alert("‰∏çÊ≠£Ëß£ÔºÅ„ÉÄ„É°„Éº„Ç∏ÔºÅ"); }
        };
        box.appendChild(btn);
    });
}

function initBoard() {
    document.getElementById('hpUI').style.display = 'flex';
    document.getElementById('bossContainer').style.display = 'block';
    const b = document.getElementById('board'); b.style.display = 'block';
    document.getElementById('ui').style.display = 'flex';
    b.innerHTML = '';
    
    // „Éá„Éê„Ç§„ÇπÈÖçÁΩÆÔºàÊúÄÂàù„ÅØÁúü„Å£„Åï„ÇâÔºÅÔºâ
    addD('p', 'ÈõªÊ∫ê', 50, 18, [['p-L','L'],['p-N','N']], 'brk');
    addD('jb', 'Joint Box', 50, 45, [['j1','1'],['j2','2'],['j3','3'],['j4','4']], 'jb');
    addD('sw', '„Çπ„Ç§„ÉÉ„ÉÅ', 30, 75, [['s-i','IN'],['s-o','OUT']], 'sw');
    addD('lp', 'ÁÖßÊòé', 70, 75, [['l-L','L'],['l-N','N']], 'lp');
    
    window.addEventListener('resize', drawWires);
}

function addD(id, name, x, y, ts, type) {
    const d = document.createElement('div');
    d.className = 'device'; d.style.left = x+'%'; d.style.top = y+'%';
    let icon = (type==='lp') ? '<div class="icon-lp">√ó</div>' : '<div class="icon-brk"></div>';
    let html = `<h3>${name}</h3>${icon}<div class="t-row">`;
    ts.forEach(t => html += `<div class="term" data-id="${t[0]}" onclick="termClick(this)">${t[1]}</div>`);
    d.innerHTML = html + `</div>`;
    document.getElementById('board').appendChild(d);
}

function termClick(el) {
    if(!selTerm) { 
        selTerm = el; el.classList.add('sel'); 
    } else {
        if(selTerm !== el) {
            lines.push([selTerm.dataset.id, el.dataset.id]);
            drawWires();
        }
        selTerm.classList.remove('sel'); selTerm = null;
    }
}

function drawWires() {
    const svg = document.getElementById('wireLayer'); svg.innerHTML = '';
    lines.forEach(pair => {
        const t1 = document.querySelector(`[data-id="${pair[0]}"]`);
        const t2 = document.querySelector(`[data-id="${pair[1]}"]`);
        if(!t1 || !t2) return;
        
        const r1 = t1.getBoundingClientRect(); const r2 = t2.getBoundingClientRect();
        const x1 = r1.left + r1.width/2; const y1 = r1.top + r1.height/2;
        const x2 = r2.left + r2.width/2; const y2 = r2.top + r2.height/2;

        const isBlack = pair[0].match(/L|i|o|1/) || pair[1].match(/L|i|o|1/);
        
        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        const d = `M ${x1} ${y1} Q ${(x1+x2)/2} ${(y1+y2)/2 - 15} ${x2} ${y2}`;
        path.setAttribute("d", d);
        path.setAttribute("class", `wire-path ${isBlack ? 'wire-black' : 'wire-white'}`);
        svg.appendChild(path);

        const glow = path.cloneNode();
        glow.setAttribute("class", "wire-path wire-glow");
        svg.appendChild(glow);
    });
}

function checkCircuit() {
    if(!swOn) { alert("„Çπ„Ç§„ÉÉ„ÉÅ„ÅåOFF„Å†ÔºÅ"); return; }
    
    const adj = {};
    lines.forEach(l => {
        if(!adj[l[0]]) adj[l[0]] = []; if(!adj[l[1]]) adj[l[1]] = [];
        adj[l[0]].push(l[1]); adj[l[1]].push(l[0]);
    });
    
    // „Çπ„Ç§„ÉÉ„ÉÅ„Å®ÁÖßÊòé„ÅÆÂÜÖÈÉ®„É≠„Ç∏„ÉÉ„ÇØ
    if(adj['s-i'] && adj['s-o']) { adj['s-i'].push('s-o'); adj['s-o'].push('s-i'); }
    if(adj['l-L'] && adj['l-N']) { adj['l-L'].push('l-N'); adj['l-N'].push('l-L'); }

    const visit = new Set();
    function dfs(c) {
        if(c === 'p-N') return true;
        visit.add(c);
        for(let n of (adj[c]||[])) { if(!visit.has(n) && dfs(n)) return true; }
        return false;
    }

    if(dfs('p-L')) {
        document.querySelectorAll('.wire-glow').forEach(el => el.style.display = 'block');
        setTimeout(() => { damageBoss(34); }, 600);
    } else {
        alert("‰∏çÁÇπÁÅØ... Êñ≠Á∑ö„Åó„Å¶„ÅÑ„Çã„ÅûÔºÅ");
        damagePlayer(15);
    }
}

function damagePlayer(amt) {
    pHP -= amt;
    document.getElementById('playerHPBar').style.width = Math.max(0, pHP) + '%';
    document.body.classList.add('shake');
    setTimeout(() => { document.body.classList.remove('shake'); }, 400);
    if(pHP <= 0) { alert("ÁèæÂ†¥ËøΩÊîæ...ÔºÅ"); location.reload(); }
}

function damageBoss(amt) {
    bHP -= amt;
    const bFill = document.getElementById('bossHPBar');
    bFill.style.width = Math.max(0, bHP) + '%';
    
    // „ÉÄ„É°„Éº„Ç∏ÊºîÂá∫
    const flash = document.getElementById('hitFlash');
    flash.style.display = 'block';
    document.getElementById('bossContainer').classList.add('shake');
    
    setTimeout(() => {
        flash.style.display = 'none';
        document.getElementById('bossContainer').classList.remove('shake');
        if(bHP <= 0) { alert("ÊíÉÁ†¥ÔºÅÁ•ûÈÄöÈõªÂÆå‰∫ÜÔºÅ"); location.reload(); }
    }, 400);
}

function toggleSW() {
    swOn = !swOn;
    const btn = document.getElementById('swToggle');
    btn.innerText = `„Çπ„Ç§„ÉÉ„ÉÅ: ${swOn ? 'ON' : 'OFF'}`;
    btn.style.background = swOn ? '#ffd000' : '#444';
    btn.style.color = swOn ? '#000' : '#fff';
}

function resetWires() { lines = []; drawWires(); }
</script>
</body>
</html>
