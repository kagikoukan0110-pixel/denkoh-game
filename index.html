<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¿ºã‚‰ã®é›»å·¥ - GOD CONNECTION</title>
    <style>
        :root {
            --gold: #ffd700;
            --gold-glow: 0 0 15px #ffd700, 0 0 30px #b8860b;
            --bg: #000;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: #fff; font-family: 'Arial Black', sans-serif; overflow: hidden; }

        /* ã‚¿ã‚¤ãƒˆãƒ« (IMG_2184å†ç¾) */
        #title-screen {
            position: fixed; inset: 0; z-index: 1000; background: #000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .neon-title { font-size: 12vw; color: var(--gold); text-shadow: var(--gold-glow); margin: 0; }
        .sub-title { letter-spacing: 0.5em; font-size: 3vw; color: #aaa; margin-bottom: 50px; }
        .start-btn {
            background: var(--gold); padding: 15px 50px; border-radius: 50px;
            font-size: 6vw; font-weight: 900; border: none; cursor: pointer; box-shadow: var(--gold-glow);
        }

        /* HUD (IMG_2188å†ç¾) */
        #hud {
            position: fixed; top: 10px; width: 100%; display: none;
            justify-content: space-around; z-index: 500; font-size: 14px;
        }
        .hp-bar { width: 40%; height: 15px; background: #333; border: 1px solid #555; position: relative; }
        .hp-fill { height: 100%; transition: width 0.3s; }
        #p-hp { background: var(--gold); width: 100%; }
        #b-hp { background: #f00; width: 100%; }

        /* ãƒœã‚¹æ¼”å‡º */
        #boss-area {
            position: absolute; top: 15%; left: 50%; transform: translateX(-50%);
            width: 200px; height: 150px; z-index: 1; opacity: 0.4;
            display: none; background: radial-gradient(circle, #f00 0%, transparent 70%);
        }
        .boss-img { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 100px; }

        /* ã‚²ãƒ¼ãƒ ç›¤é¢ (IMG_2183, 2196ä¿®æ­£) */
        #game-stage {
            position: relative; width: 100vw; height: 100vh; display: none;
            background: #0a0a0a; overflow: hidden;
        }
        .device {
            position: absolute; background: #ccc; border: 3px solid #888; border-radius: 10px;
            color: #000; padding: 10px; z-index: 10; width: 120px; text-align: center;
        }
        .device-name { font-size: 12px; font-weight: bold; border-bottom: 1px solid #888; margin-bottom: 8px; }
        .term-box { display: flex; justify-content: space-around; }
        .term {
            width: 30px; height: 30px; background: #222; border-radius: 50%;
            color: #fff; display: flex; align-items: center; justify-content: center;
            font-size: 10px; cursor: pointer; border: 2px solid #444; position: relative;
        }
        .term.selected { border-color: #f00; box-shadow: 0 0 10px #f00; }

        /* é…ç·šãƒ¬ã‚¤ãƒ¤ãƒ¼ (ã“ã“ãŒé‡è¦ï¼šæœ€å‰é¢) */
        #svg-layer {
            position: absolute; inset: 0; z-index: 100; pointer-events: none;
        }
        .wire { stroke-width: 8; stroke-linecap: round; transition: 0.3s; fill: none; }
        .gold-flow { stroke: var(--gold); stroke-dasharray: 20; animation: flow 1s linear infinite; filter: drop-shadow(0 0 5px var(--gold)); }
        @keyframes flow { to { stroke-dashoffset: -40; } }

        /* ã‚¯ã‚¤ã‚º (IMG_2185å†ç¾ï¼š4æŠ) */
        #quiz-modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 800;
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }
        .quiz-card { background: #222; padding: 20px; border-radius: 15px; width: 90%; max-width: 400px; text-align: center; }
        .ans-btn {
            display: block; width: 100%; padding: 15px; margin: 10px 0;
            background: #333; color: #fff; border: 1px solid #555; border-radius: 8px; font-size: 16px;
        }

        /* æ“ä½œãƒ‘ãƒãƒ« (IMG_2181å†ç¾) */
        #controls {
            position: fixed; bottom: 30px; width: 100%; display: none;
            flex-direction: column; align-items: center; z-index: 500;
        }
        .btn-row { display: flex; gap: 10px; margin-bottom: 15px; }
        .sub-btn { background: #444; color: #fff; padding: 10px 20px; border-radius: 5px; border: none; }
        #set-btn {
            width: 80%; padding: 20px; background: var(--gold); color: #000;
            border-radius: 50px; font-size: 24px; font-weight: 900; border: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }

        /* æ’ƒç ´æ¼”å‡º */
        #victory-text {
            position: fixed; inset: 0; z-index: 2000; display: none;
            background: #fff; color: var(--gold); font-size: 80px;
            align-items: center; justify-content: center; text-shadow: 2px 2px 10px #000;
        }
    </style>
</head>
<body>

<div id="title-screen">
    <h1 class="neon-title">ä¿ºã‚‰ã®é›»å·¥</h1>
    <div class="sub-title">GOD CONNECTION</div>
    <button class="start-btn" onclick="startGame()">ç¾å ´å…¥ã‚Š</button>
</div>

<div id="hud">
    <div class="hp-bar">PLAYER: <div id="p-hp" class="hp-fill"></div></div>
    <div class="hp-bar">BOSS: <div id="b-hp" class="hp-fill"></div></div>
</div>

<div id="boss-area"><div class="boss-img">ğŸ‘¹</div></div>

<div id="quiz-modal">
    <div class="quiz-card">
        <h2 style="color:var(--gold)">å­¦ç§‘è©¦é¨“</h2>
        <p id="q-text"></p>
        <div id="ans-list"></div>
    </div>
</div>

<div id="game-stage"></div>
<svg id="svg-layer"></svg>

<div id="controls">
    <div class="btn-row">
        <button id="sw-state" class="sub-btn" onclick="toggleSwitch()">SWITCH: OFF</button>
        <button class="sub-btn" onclick="resetWires()">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>
    <button id="set-btn" onclick="checkCircuit()">SET (é€šé›»ç¢ºèª)</button>
</div>

<div id="victory-text">æ’ƒ ç ´</div>

<script>
    const state = {
        pHP: 100, bHP: 100,
        qIdx: 0,
        lines: [],
        selected: null,
        swOn: false,
        // ãƒ‡ãƒã‚¤ã‚¹é…ç½® (IMG_2181åŸºæº–)
        devices: [
            { id: 'PWR', name: 'é›»æº', x: 50, y: 15, terms: ['L', 'N'] },
            { id: 'JB', name: 'Joint Box', x: 50, y: 45, terms: ['1', '2', '3', '4'] },
            { id: 'SW', name: 'ã‚¹ã‚¤ãƒƒãƒ', x: 25, y: 75, terms: ['IN', 'OUT'] },
            { id: 'LMP', name: 'ç…§æ˜', x: 75, y: 75, terms: ['L', 'N'] }
        ],
        quizzes: [
            { q: "æ¥åœ°å´ï¼ˆç™½ç·šï¼‰ã‚’ç¹‹ãã¹ãç«¯å­è¨˜å·ã¯ï¼Ÿ", a: ["L", "W (N)", "E", "S"], c: 1 },
            { q: "éæ¥åœ°å´ï¼ˆé»’ç·šï¼‰ã®è‰²ã¯ï¼Ÿ", a: ["èµ¤", "ç™½", "é»’", "ç·‘"], c: 2 },
            { q: "å›è·¯ã‚’é®æ–­ã™ã¹ãç·šã¯ï¼Ÿ", a: ["ç™½ç·š", "é»’ç·š", "æ¥åœ°ç·š", "ã©ã‚Œã§ã‚‚ã„ã„"], c: 1 },
            { q: "ç…§æ˜å™¨å…·ã®å›³è¨˜å·ã¯ï¼Ÿ", a: ["â—", "â—‹", "Ã—", "â–¡"], c: 2 }
        ]
    };

    function startGame() {
        document.getElementById('title-screen').style.display = 'none';
        showQuiz();
    }

    function showQuiz() {
        if (state.qIdx >= state.quizzes.length) {
            document.getElementById('quiz-modal').style.display = 'none';
            initBoard();
            return;
        }
        const q = state.quizzes[state.qIdx];
        document.getElementById('quiz-modal').style.display = 'flex';
        document.getElementById('q-text').innerText = q.q;
        const list = document.getElementById('ans-list');
        list.innerHTML = '';
        q.a.forEach((txt, i) => {
            const b = document.createElement('button');
            b.className = 'ans-btn';
            b.innerText = txt;
            b.onclick = () => {
                if (i === q.c) { state.qIdx++; showQuiz(); }
                else { alert("å­¦ç§‘ä¸åˆæ ¼ã ï¼ã‚„ã‚Šç›´ã—ï¼"); }
            };
            list.appendChild(b);
        });
    }

    function initBoard() {
        document.getElementById('hud').style.display = 'flex';
        document.getElementById('game-stage').style.display = 'block';
        document.getElementById('controls').style.display = 'flex';
        document.getElementById('boss-area').style.display = 'block';
        
        const stage = document.getElementById('game-stage');
        stage.innerHTML = '';
        state.devices.forEach(d => {
            const el = document.createElement('div');
            el.className = 'device';
            el.style.left = `calc(${d.x}% - 60px)`;
            el.style.top = `${d.y}%`;
            el.innerHTML = `<div class="device-name">${d.name}</div><div class="term-box">` + 
                d.terms.map(t => `<div class="term" id="${d.id}-${t}">${t}</div>`).join('') + `</div>`;
            stage.appendChild(el);
        });

        document.querySelectorAll('.term').forEach(t => {
            t.onclick = (e) => {
                const id = e.target.id;
                if (!state.selected) {
                    state.selected = id;
                    e.target.classList.add('selected');
                } else {
                    if (state.selected !== id) {
                        state.lines.push([state.selected, id]);
                        drawWires();
                    }
                    document.getElementById(state.selected).classList.remove('selected');
                    state.selected = null;
                }
            };
        });
    }

    function drawWires() {
        const svg = document.getElementById('svg-layer');
        svg.innerHTML = '';
        state.lines.forEach(pair => {
            const t1 = document.getElementById(pair[0]).getBoundingClientRect();
            const t2 = document.getElementById(pair[1]).getBoundingClientRect();
            
            // ç™½é»’åˆ¤å®š (æ¥åœ°å´ã‹)
            const isN = pair[0].includes('-N') || pair[1].includes('-N') || pair[0].includes('JB-2') || pair[1].includes('JB-2');
            const color = isN ? '#fff' : '#000';

            const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
            line.setAttribute("x1", t1.left + 15);
            line.setAttribute("y1", t1.top + 15);
            line.setAttribute("x2", t2.left + 15);
            line.setAttribute("y2", t2.top + 15);
            line.setAttribute("stroke", color);
            line.setAttribute("class", "wire");
            line.id = `wire-${pair[0]}-${pair[1]}`;
            svg.appendChild(line);
        });
    }

    function toggleSwitch() {
        state.swOn = !state.swOn;
        document.getElementById('sw-state').innerText = `SWITCH: ${state.swOn ? 'ON' : 'OFF'}`;
    }

    function resetWires() {
        state.lines = [];
        drawWires();
    }

    function checkCircuit() {
        if (!state.swOn) { alert("ã‚¹ã‚¤ãƒƒãƒãŒOFFã ï¼"); return; }
        
        // ç°¡æ˜“å°é€šãƒ­ã‚¸ãƒƒã‚¯ (Lã‹ã‚‰å…¥ã‚ŠNã«å¸°ã‚‹ã‹)
        const connections = {};
        state.lines.forEach(([a, b]) => {
            if (!connections[a]) connections[a] = [];
            if (!connections[b]) connections[b] = [];
            connections[a].push(b); connections[b].push(a);
        });

        // å›è·¯åˆ¤å®š (L -> SW -> LMP -> N ã®ãƒ‘ã‚¹ãŒã‚ã‚‹ã‹)
        const canFlow = findPath('PWR-L', 'PWR-N', connections);

        if (canFlow) {
            document.querySelectorAll('.wire').forEach(w => w.classList.add('gold-flow'));
            setTimeout(() => {
                state.bHP -= 34;
                document.getElementById('b-hp').style.width = state.bHP + '%';
                if (state.bHP <= 0) {
                    document.getElementById('victory-text').style.display = 'flex';
                } else {
                    alert("é€šé›»ç¢ºèªï¼ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼");
                }
                document.querySelectorAll('.wire').forEach(w => w.classList.remove('gold-flow'));
            }, 1000);
        } else {
            alert("å›è·¯ãŒä¸å®Œå…¨ã ï¼");
        }
    }

    function findPath(start, end, graph) {
        const visited = new Set();
        const queue = [start];
        while (queue.length > 0) {
            const curr = queue.shift();
            if (curr === end) return true;
            visited.add(curr);
            (graph[curr] || []).forEach(next => {
                if (!visited.has(next)) queue.push(next);
            });
        }
        return false;
    }
</script>
</body>
</html>
