<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>俺らの電工 - COMPLETE MISSION</title>
<style>
:root{--bg:#000; --panel:#e6e6e6; --term-bg:#222; --lamp-glow: rgba(255,220,80,0.95);}
body{margin:0; background:var(--bg); color:#fff; font-family:sans-serif; overflow:hidden;}
#wireLayer{position:fixed; top:0; left:0; width:100vw; height:100vh; pointer-events:none; z-index:3000;}

/* レインボー演出用アニメーション */
@keyframes rainbow { 0% {filter: hue-rotate(0deg) brightness(1.5);} 50% {filter: hue-rotate(180deg) brightness(2.5);} 100% {filter: hue-rotate(360deg) brightness(1.5);} }
.flash-rainbow { animation: rainbow 0.1s infinite !important; }

/* モーダル */
.modal-backdrop{position:fixed; inset:0; background:rgba(0,0,0,0.95); display:none; align-items:center; justify-content:center; z-index:9999; flex-direction:column;}
.modal-backdrop.show{display:flex}
.card{width:85%; max-width:400px; background:#111; padding:20px; border-radius:15px; border:2px solid #555; text-align:center;}
.q-btn{display:block; width:100%; margin:10px 0; padding:15px; background:#444; color:#fff; border-radius:8px; border:none; cursor:pointer;}

/* デバイス */
.device{position:absolute; width:100px; min-height:130px; padding:8px; background:var(--panel); border-radius:12px; color:#000; box-shadow:0 8px 20px rgba(0,0,0,0.5); transform:translate(-50%,-50%); z-index:60; text-align:center;}
.terminal{display:inline-flex; justify-content:center; align-items:center; width:30px; height:30px; margin:3px; background:var(--term-bg); color:#fff; border-radius:50%; cursor:pointer;}
.selected{outline:3px solid #ffd800;}
.device.lit{background:#fff9c4 !important; box-shadow:0 0 40px var(--lamp-glow);}
</style>
</head>
<body>

<div id="quizScreen" class="modal-backdrop show">
  <div class="card">
    <h2 id="qText">学科試験</h2>
    <div id="answers"></div>
    <p>HP: <span id="hpDisplay">100</span></p>
  </div>
</div>

<div id="bossScreen" class="modal-backdrop">
  <div class="card">
    <h2 id="bossMsg">ダメージ！</h2>
    <img src="boss.png.jpg" style="width:100%; border-radius:8px;">
    <div style="height:20px; background:#333; margin:10px 0;"><div id="bossHP" style="height:100%; width:100%; background:red;"></div></div>
  </div>
</div>

<div id="gameBoard" style="display:none;">
  <div id="boardContainer"></div>
  <div style="position:fixed; bottom:20px; width:100%; text-align:center;">
    <button id="setBtn" style="padding:15px 40px; background:#ffd000;">SET（通電確認）</button>
  </div>
</div>

<script>
// --- ゲームデータ・設定 ---
const quizData = [
  {q: "電気工事士法で従事できるのは？", a: ["誰でも", "資格保持者", "大工", "警備員"], correct: 1},
  {q: "100V回路で許容電流最大は？", a: ["1.6mm", "2.0mm", "2.6mm", "3.2mm"], correct: 3},
  {q: "圧着接続で使うのは？", a: ["ペンチ", "素手", "専用工具", "接着剤"], correct: 2},
  {q: "短絡（ショート）の説明は？", a: ["電流0", "過大電流", "電圧増", "抵抗増"], correct: 1},
  {q: "接地抵抗が最も低いのは？", a: ["A種", "B種", "C種", "D種"], correct: 0}
];

let hp = 100, currentQ = 0, round = 1, connections = [];

// --- クイズエンジン ---
function renderQuiz() {
  if(currentQ >= quizData.length) {
    document.getElementById('quizScreen').classList.remove('show');
    document.getElementById('gameBoard').style.display = 'block';
    setupRound();
    return;
  }
  const d = quizData[currentQ];
  document.getElementById('qText').textContent = d.q;
  const ans = document.getElementById('answers'); ans.innerHTML = '';
  d.a.forEach((txt, i) => {
    const btn = document.createElement('button'); btn.className = 'q-btn'; btn.textContent = txt;
    btn.onclick = () => {
      if(i !== d.correct) { hp -= 20; document.getElementById('hpDisplay').textContent = hp; }
      if(hp <= 0) { alert("ゲームオーバー"); location.reload(); }
      currentQ++; renderQuiz();
    };
    ans.appendChild(btn);
  });
}

// --- ボス撃破時のド派手演出 ---
function triggerBossFlash() {
  document.body.classList.add('flash-rainbow');
  setTimeout(() => document.body.classList.remove('flash-rainbow'), 2000);
}

// --- 実技ボード配置 (重なり防止処理を含めた本来のロジック) ---
function setupRound() {
  const cont = document.getElementById('boardContainer');
  cont.innerHTML = '';
  // ここに「重ならない配置」の高度なロジックを挿入
  // (前回伝えた配列ベースの座標管理＋衝突判定ルーチンを呼び出す)
  console.log("ラウンド開始: " + round);
}

// --- SETボタン判定 ---
document.getElementById('setBtn').onclick = () => {
  // 配線回路のチェック (正解・不正解処理)
  // ... (配線チェックロジック) ...
  
  // 成功時
  triggerBossFlash();
  document.getElementById('bossScreen').style.display = 'flex';
  
  setTimeout(() => {
    document.getElementById('bossScreen').style.display = 'none';
    if(round < 3) {
      round++;
      setupRound();
    } else {
      alert("完全攻略！");
      location.reload();
    }
  }, 2000);
};

// 初期起動
renderQuiz();
</script>
</body>
</html>
