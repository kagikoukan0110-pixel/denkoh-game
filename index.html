<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ë§áÁ∑öÂõ≥„É¢„Éº„Éâ - Ê®°ÁØÑË°®Á§∫</title>

<style>
body{
  text-align:center;
  font-family:sans-serif;
  background:#f0f0f0;
  margin:0;
}

#board{
  width:360px;
  height:500px;
  margin:20px auto;
  background:white;
  border:2px solid black;
  position:relative;
}

.node{
  width:80px;
  height:40px;
  border:2px solid black;
  text-align:center;
  line-height:40px;
  position:absolute;
  background:#ddd;
}

.terminal{
  width:18px;
  height:18px;
  border-radius:50%;
  background:black;
  position:absolute;
  cursor:pointer;
}

.jb{
  width:120px;
  height:120px;
  border:3px solid #333;
  position:absolute;
  top:190px;
  left:120px;
  background:#fafafa;
}

.line{
  position:absolute;
  background:black;
  height:3px;
  transform-origin:0 0;
}

.selected{
  background:red !important;
}

#score{
  font-size:18px;
}

#message{
  font-size:20px;
  font-weight:bold;
}

#answerImage{
  display:none;
  margin-top:15px;
}
</style>
</head>

<body>

<h2>‚ö° Ë§áÁ∑öÂõ≥„É¢„Éº„Éâ - „Ç∏„Éß„Ç§„É≥„Éà„Éú„ÉÉ„ÇØ„Çπ</h2>

<div id="board">

  <div class="node" style="top:40px; left:20px;">ÈõªÊ∫ê</div>
  <div class="terminal" data-id="L" style="top:90px; left:50px;"></div>
  <div class="terminal" data-id="N" style="top:120px; left:50px;"></div>

  <div class="node" style="top:40px; left:250px;">SW</div>
  <div class="terminal" data-id="SW1" style="top:90px; left:280px;"></div>
  <div class="terminal" data-id="SW2" style="top:120px; left:280px;"></div>

  <div class="node" style="top:400px; left:140px;">„É©„É≥„Éó</div>
  <div class="terminal" data-id="Lamp1" style="top:360px; left:165px;"></div>
  <div class="terminal" data-id="Lamp2" style="top:360px; left:195px;"></div>

  <div class="jb"></div>

  <div class="terminal" data-id="JB1" style="top:210px; left:140px;"></div>
  <div class="terminal" data-id="JB2" style="top:210px; left:190px;"></div>
  <div class="terminal" data-id="JB3" style="top:210px; left:240px;"></div>

</div>

<div id="score">„Çπ„Ç≥„Ç¢: 10000</div>
<div id="message"></div>
<button onclick="resetGame()">„É™„Çª„ÉÉ„Éà</button>

<!-- Ê≠£Ëß£ÁîªÂÉèÔºàÁ∞°ÊòìSVGÔºâ -->
<div id="answerImage">
  <h3>Ê®°ÁØÑË§áÁ∑öÂõ≥</h3>
  <svg width="300" height="200">
    <line x1="20" y1="50" x2="120" y2="100" stroke="black" stroke-width="3"/>
    <line x1="280" y1="50" x2="170" y2="100" stroke="black" stroke-width="3"/>
    <line x1="150" y1="180" x2="150" y2="120" stroke="black" stroke-width="3"/>
    <text x="10" y="45">L</text>
    <text x="280" y="45">SW</text>
    <text x="145" y="195">Lamp</text>
  </svg>
</div>

<script>

let selected=null;
let score=10000;
let connections=[];

const board=document.getElementById("board");
const scoreDisplay=document.getElementById("score");
const message=document.getElementById("message");
const answerImage=document.getElementById("answerImage");

const correctPairs=[
  ["L","JB1"],
  ["SW1","JB1"],
  ["SW2","JB2"],
  ["Lamp1","JB2"],
  ["N","JB3"],
  ["Lamp2","JB3"]
];

document.querySelectorAll(".terminal").forEach(t=>{
  t.addEventListener("click",()=>handleClick(t));
});

function handleClick(t){
  if(!selected){
    selected=t;
    t.classList.add("selected");
  }else{
    if(selected===t) return;
    createLine(selected,t);
    check(selected.dataset.id,t.dataset.id);
    selected.classList.remove("selected");
    selected=null;
  }
}

function createLine(a,b){
  let ra=a.getBoundingClientRect();
  let rb=b.getBoundingClientRect();
  let rbBoard=board.getBoundingClientRect();

  let x1=ra.left-rbBoard.left+9;
  let y1=ra.top-rbBoard.top+9;
  let x2=rb.left-rbBoard.left+9;
  let y2=rb.top-rbBoard.top+9;

  let len=Math.hypot(x2-x1,y2-y1);

  let line=document.createElement("div");
  line.className="line";
  line.style.left=x1+"px";
  line.style.top=y1+"px";
  line.style.width=len+"px";
  line.style.transform="rotate("+Math.atan2(y2-y1,x2-x1)+"rad)";
  board.appendChild(line);
}

function check(a,b){
  let ok=correctPairs.some(p=>
    (p[0]===a&&p[1]===b)||(p[0]===b&&p[1]===a)
  );

  if(!ok){
    score-=1500;
  }else{
    connections.push([a,b]);
  }

  scoreDisplay.innerText="„Çπ„Ç≥„Ç¢: "+score;

  if(connections.length===correctPairs.length){
    message.innerText="üí° Ê≠£Ëß£ÔºÅ„É©„É≥„ÉóÁÇπÁÅØÔºÅ";
    answerImage.style.display="block";
  }
}

function resetGame(){
  document.querySelectorAll(".line").forEach(l=>l.remove());
  connections=[];
  score=10000;
  scoreDisplay.innerText="„Çπ„Ç≥„Ç¢: 10000";
  message.innerText="";
  answerImage.style.display="none";
}

</script>

</body>
</html>
