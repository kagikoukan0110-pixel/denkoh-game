<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è¤‡ç·šå›³ãƒ¢ãƒ¼ãƒ‰ - ç›´æ„Ÿé…ç·šç‰ˆ</title>
<style>
body{ text-align:center;font-family:sans-serif;background:#f0f0f0;margin:0; }
#board{ width:360px;height:500px;margin:20px auto;background:white;border:2px solid black;position:relative; }

.node{ width:80px;height:40px;border:2px solid black;text-align:center;line-height:40px;position:absolute;background:#ddd; }

.terminal{
  width:18px;height:18px;border-radius:50%;
  position:absolute;cursor:pointer;border:2px solid #333;
}

.black{ background:black; }
.white{ background:white; }

.selected{ outline:3px solid red; }

.jb{ width:120px;height:120px;border:3px solid #333;position:absolute;top:190px;left:120px;background:#fafafa; }

.line{
  position:absolute;height:3px;background:black;transform-origin:0 0;
}

#message{ font-size:20px;font-weight:bold;margin-top:10px; }
button{ margin:4px;padding:6px 10px; }
</style>
</head>
<body>

<h2>âš¡ è¤‡ç·šå›³ãƒ¢ãƒ¼ãƒ‰ - ç›´æ„Ÿé…ç·šç‰ˆ</h2>

<div id="board">

<div class="node" style="top:40px; left:20px;">é›»æº</div>
<div class="terminal black" data-id="L" style="top:90px; left:50px;"></div>
<div class="terminal white" data-id="N" style="top:120px; left:50px;"></div>

<div class="node" style="top:40px; left:250px;">SW</div>
<div class="terminal black" data-id="SW1" style="top:90px; left:280px;"></div>
<div class="terminal black" data-id="SW2" style="top:120px; left:280px;"></div>

<div class="node" style="top:400px; left:140px;">ãƒ©ãƒ³ãƒ—</div>
<div class="terminal black" data-id="Lamp1" style="top:360px; left:165px;"></div>
<div class="terminal white" data-id="Lamp2" style="top:360px; left:195px;"></div>

<div class="jb"></div>

<div class="terminal black" data-id="JB1" data-jb="true" style="top:210px; left:140px;"></div>
<div class="terminal black" data-id="JB2" data-jb="true" style="top:210px; left:190px;"></div>
<div class="terminal black" data-id="JB3" data-jb="true" style="top:210px; left:240px;"></div>
<div class="terminal black" data-id="JB4" data-jb="true" style="top:260px; left:140px;"></div>
<div class="terminal black" data-id="JB5" data-jb="true" style="top:260px; left:190px;"></div>
<div class="terminal black" data-id="JB6" data-jb="true" style="top:260px; left:240px;"></div>

</div>

<button onclick="analyze()">è§£æï¼ˆSW ONï¼‰</button>
<button onclick="resetGame()">ãƒªã‚»ãƒƒãƒˆ</button>

<div id="message"></div>

<script>

let selected=[];
let parent={};
const board=document.getElementById("board");

function init(){
  parent={};
  document.querySelectorAll(".terminal").forEach(t=>{
    parent[t.dataset.id]=t.dataset.id;
    t.classList.remove("selected");
  });
  document.querySelectorAll(".line").forEach(l=>l.remove());
}
init();

function find(x){
  if(parent[x]!==x) parent[x]=find(parent[x]);
  return parent[x];
}

function union(a,b){
  let pa=find(a);
  let pb=find(b);
  if(pa!==pb) parent[pb]=pa;
}

function drawLine(a,b){
  const ra=a.getBoundingClientRect();
  const rb=b.getBoundingClientRect();
  const rBoard=board.getBoundingClientRect();

  const x1=ra.left-rBoard.left+9;
  const y1=ra.top-rBoard.top+9;
  const x2=rb.left-rBoard.left+9;
  const y2=rb.top-rBoard.top+9;

  const len=Math.hypot(x2-x1,y2-y1);

  const line=document.createElement("div");
  line.className="line";
  line.style.left=x1+"px";
  line.style.top=y1+"px";
  line.style.width=len+"px";
  line.style.transform="rotate("+Math.atan2(y2-y1,x2-x1)+"rad)";
  board.appendChild(line);
}

document.querySelectorAll(".terminal").forEach(t=>{
  t.addEventListener("click",()=>{
    t.classList.add("selected");
    selected.push(t);

    if(selected.length===2){
      const a=selected[0];
      const b=selected[1];

      // å™¨å…·åŒå£«ã¯ç¦æ­¢
      if(!a.dataset.jb && !b.dataset.jb){
        document.getElementById("message").innerText="âŒ å™¨å…·åŒå£«ã¯æ¥ç¶šä¸å¯";
      }else{
        union(a.dataset.id,b.dataset.id);
        drawLine(a,b);
      }

      selected.forEach(x=>x.classList.remove("selected"));
      selected=[];
    }
  });
});

function analyze(){
  union("SW1","SW2");

  if(find("L")===find("N")){
    document.getElementById("message").innerText="ğŸ”¥ L-Nã‚·ãƒ§ãƒ¼ãƒˆï¼";
    return;
  }

  if(
    find("L")===find("SW1") &&
    find("SW2")===find("Lamp1") &&
    find("Lamp2")===find("N")
  ){
    document.getElementById("message").innerText="ğŸ’¡ æ­£è§£ï¼å›è·¯æˆç«‹ï¼";
  }else{
    document.getElementById("message").innerText="âŒ å›è·¯ä¸æˆç«‹";
  }
}

function resetGame(){
  document.getElementById("message").innerText="";
  selected=[];
  init();
}

</script>
</body>
</html>
