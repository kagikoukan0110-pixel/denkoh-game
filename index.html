<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä¸‰è·¯å›è·¯ãƒ¢ãƒ¼ãƒ‰</title>
<style>
body{font-family:sans-serif;text-align:center;background:#f2f2f2;margin:0;}
#board{width:400px;height:600px;margin:20px auto;background:white;border:3px solid black;position:relative;}
.node{width:100px;height:40px;border:2px solid black;line-height:40px;position:absolute;background:#ddd;font-weight:bold;}
.terminal{width:20px;height:20px;border-radius:50%;position:absolute;cursor:pointer;border:2px solid #333;}
.black{background:black;}
.white{background:white;}
.selected{outline:3px solid red;}
.line{position:absolute;height:4px;transform-origin:0 0;}
button{margin:6px;padding:8px 14px;}
#msg{white-space:pre-line;font-weight:bold;margin-top:10px;}
</style>
</head>
<body>

<h2>âš¡ ä¸‰è·¯å›è·¯ãƒ¢ãƒ¼ãƒ‰</h2>

<div id="board">

<div class="node" style="top:30px; left:20px;">é›»æº</div>
<div class="terminal black" data-id="L" data-color="black" style="top:80px; left:70px;"></div>
<div class="terminal white" data-id="N" data-color="white" style="top:110px; left:70px;"></div>

<div class="node" style="top:30px; left:250px;">ä¸‰è·¯SW1</div>
<div class="terminal black" data-id="S1C" style="top:80px; left:300px;"></div>
<div class="terminal black" data-id="S1T1" style="top:110px; left:280px;"></div>
<div class="terminal black" data-id="S1T2" style="top:110px; left:320px;"></div>

<div class="node" style="top:250px; left:250px;">ä¸‰è·¯SW2</div>
<div class="terminal black" data-id="S2C" style="top:300px; left:300px;"></div>
<div class="terminal black" data-id="S2T1" style="top:330px; left:280px;"></div>
<div class="terminal black" data-id="S2T2" style="top:330px; left:320px;"></div>

<div class="node" style="top:500px; left:140px;">ãƒ©ãƒ³ãƒ—</div>
<div class="terminal black" data-id="Lamp1" data-color="black" style="top:460px; left:170px;"></div>
<div class="terminal white" data-id="Lamp2" data-color="white" style="top:460px; left:210px;"></div>

</div>

<button onclick="toggleS1()">SW1åˆ‡æ›¿</button>
<button onclick="toggleS2()">SW2åˆ‡æ›¿</button>
<button onclick="analyze()">è§£æ</button>
<button onclick="resetGame()">ãƒªã‚»ãƒƒãƒˆ</button>

<div id="msg"></div>

<script>

let parent={}, connections={}, selected=[];
let s1pos=0, s2pos=0;

function init(){
  parent={}; connections={};
  document.querySelectorAll(".terminal").forEach(t=>{
    parent[t.dataset.id]=t.dataset.id;
    connections[t.dataset.id]=[];
    t.classList.remove("selected");
  });
  document.querySelectorAll(".line").forEach(l=>l.remove());
}
init();

function find(x){
  if(parent[x]!==x) parent[x]=find(parent[x]);
  return parent[x];
}

function union(a,b){
  let pa=find(a), pb=find(b);
  if(pa!==pb) parent[pb]=pa;
  connections[a].push(b);
  connections[b].push(a);
}

function drawLine(a,b){
  const ra=a.getBoundingClientRect();
  const rb=b.getBoundingClientRect();
  const boardRect=document.getElementById("board").getBoundingClientRect();
  const x1=ra.left-boardRect.left+10;
  const y1=ra.top-boardRect.top+10;
  const x2=rb.left-boardRect.left+10;
  const y2=rb.top-boardRect.top+10;
  const len=Math.hypot(x2-x1,y2-y1);
  const line=document.createElement("div");
  line.className="line";
  line.style.left=x1+"px";
  line.style.top=y1+"px";
  line.style.width=len+"px";
  line.style.background="black";
  line.style.transform="rotate("+Math.atan2(y2-y1,x2-x1)+"rad)";
  document.getElementById("board").appendChild(line);
}

document.querySelectorAll(".terminal").forEach(t=>{
  t.addEventListener("click",()=>{
    t.classList.add("selected");
    selected.push(t);
    if(selected.length===2){
      const a=selected[0], b=selected[1];
      union(a.dataset.id,b.dataset.id);
      drawLine(a,b);
      selected.forEach(x=>x.classList.remove("selected"));
      selected=[];
    }
  });
});

function toggleS1(){
  s1pos = 1-s1pos;
  document.getElementById("msg").innerText="SW1ä½ç½®ï¼š"+s1pos;
}

function toggleS2(){
  s2pos = 1-s2pos;
  document.getElementById("msg").innerText="SW2ä½ç½®ï¼š"+s2pos;
}

function applySwitchLogic(){
  if(s1pos===0) union("S1C","S1T1");
  else union("S1C","S1T2");

  if(s2pos===0) union("S2C","S2T1");
  else union("S2C","S2T2");
}

function analyze(){
  applySwitchLogic();

  if(find("L")===find("N")){
    show("ğŸ”¥ L-Nã‚·ãƒ§ãƒ¼ãƒˆ");
    return;
  }

  let visited=new Set();
  function dfs(n){
    if(visited.has(n)) return;
    visited.add(n);
    connections[n].forEach(dfs);
  }

  dfs("L");

  if(visited.has("Lamp1") && find("Lamp2")===find("N")){
    show("ğŸ’¡ ãƒ©ãƒ³ãƒ—ç‚¹ç¯ï¼");
  }else{
    show("âŒ ä¸æˆç«‹\nä¸‰è·¯çµŒè·¯ãŒæˆç«‹ã—ã¦ã„ãªã„");
  }
}

function show(msg){
  document.getElementById("msg").innerText=msg;
}

function resetGame(){
  selected=[];
  s1pos=0; s2pos=0;
  show("");
  init();
}

</script>
</body>
</html>
