<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¿ºã‚‰ã®é›»å·¥ - GOD CONNECTION (çœŸãƒ»å®Œæˆç‰ˆ)</title>
    <style>
        :root { --gold: #ffd700; --bg: #000; }
        * { box-sizing: border-box; touch-action: manipulation; }
        body { margin: 0; background: var(--bg); color: #fff; font-family: sans-serif; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }

        /* HUD (ä¸Šéƒ¨) */
        #hud { height: 60px; display: none; justify-content: space-around; align-items: center; background: #111; border-bottom: 2px solid #333; z-index: 1000; }
        .hp-container { width: 45%; }
        .hp-bar { height: 12px; background: #333; border-radius: 6px; overflow: hidden; }
        .hp-fill { height: 100%; transition: width 0.3s; }

        /* ç¾å ´ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ (ä¸­å¤®ï¼šãƒ‡ãƒã‚¤ã‚¹é…ç½®ã‚¨ãƒªã‚¢) */
        #stage { 
            flex: 1; position: relative; background: #050505; 
            display: none; overflow: hidden; 
        }
        
        /* ãƒœã‚¹ (èƒŒå¾Œ) */
        #boss-bg {
            position: absolute; top: 10%; left: 50%; transform: translateX(-50%);
            font-size: 150px; opacity: 0.2; filter: grayscale(1) sepia(1) saturate(10) hue-rotate(-50deg);
            z-index: 1; pointer-events: none;
        }

        /* ãƒ‡ãƒã‚¤ã‚¹ (IMG_2183/2181å†ç¾) */
        .device {
            position: absolute; background: #d0d0d0; border: 4px solid #888; border-radius: 8px;
            color: #000; padding: 10px; z-index: 10; width: 130px; text-align: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }
        .device-header { font-size: 14px; font-weight: 900; margin-bottom: 10px; border-bottom: 2px solid #aaa; }
        .term-group { display: flex; justify-content: space-around; }
        .term {
            width: 34px; height: 34px; background: #222; border-radius: 50%;
            color: #fff; display: flex; align-items: center; justify-content: center;
            font-size: 11px; cursor: pointer; border: 3px solid #555; position: relative;
        }
        .term.active { border-color: #ff0000; background: #444; box-shadow: 0 0 15px #ff0000; }

        /* é…ç·šãƒ¬ã‚¤ãƒ¤ãƒ¼ (æœ€å‰é¢) */
        #wire-svg { position: absolute; inset: 0; z-index: 100; pointer-events: none; }
        .cable { stroke-width: 14; stroke-linecap: round; fill: none; }
        .cable-inner { stroke-width: 8; stroke-linecap: round; fill: none; }
        .gold-run { stroke: var(--gold); stroke-dasharray: 20; animation: flow 0.5s linear infinite; stroke-width: 4; }
        @keyframes flow { to { stroke-dashoffset: -40; } }

        /* æ“ä½œãƒ‘ãƒãƒ« (ä¸‹éƒ¨ï¼šçµ¶å¯¾ã«è¢«ã‚‰ãªã„) */
        #controls { 
            height: 180px; background: #1a1a1a; display: none;
            flex-direction: column; align-items: center; justify-content: center;
            border-top: 4px solid #333; gap: 15px; z-index: 1000;
        }
        .row { display: flex; gap: 20px; width: 90%; }
        .sub-btn { flex: 1; padding: 15px; background: #333; color: #fff; border: 2px solid #555; border-radius: 8px; font-weight: bold; }
        #set-btn {
            width: 90%; padding: 20px; background: var(--gold); color: #000;
            border-radius: 40px; font-size: 26px; font-weight: 900; border: none;
            box-shadow: 0 6px 0 #b29200;
        }
        #set-btn:active { transform: translateY(4px); box-shadow: 0 2px 0 #b29200; }

        /* ã‚¯ã‚¤ã‚º (IMG_2185å†ç¾) */
        #quiz-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 2000;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            padding: 20px;
        }
        .quiz-box { width: 100%; max-width: 400px; text-align: center; }
        .opt-btn {
            width: 100%; padding: 18px; margin: 8px 0; background: #222; 
            border: 2px solid #444; color: #fff; border-radius: 10px; font-size: 18px;
        }

        /* æ¼”å‡ºç”¨ */
        #flash { position: fixed; inset: 0; background: #fff; z-index: 5000; display: none; }
        #victory { position: fixed; inset: 0; background: #000; z-index: 5001; display: none; align-items: center; justify-content: center; font-size: 100px; color: var(--gold); }
    </style>
</head>
<body>

<div id="hud">
    <div class="hp-container">PLAYER: <div class="hp-bar"><div id="p-hp" class="hp-fill" style="background:var(--gold); width:100%"></div></div></div>
    <div class="hp-container">BOSS: <div class="hp-bar"><div id="b-hp" class="hp-fill" style="background:red; width:100%"></div></div></div>
</div>

<div id="stage">
    <div id="boss-bg">ğŸ‘¹</div>
</div>
<svg id="wire-svg"></svg>

<div id="controls">
    <div class="row">
        <button id="sw-btn" class="sub-btn" onclick="toggleSW()">SWITCH: OFF</button>
        <button class="sub-btn" onclick="resetGame()">RESET</button>
    </div>
    <button id="set-btn" onclick="checkFinal()">SET (é€šé›»ç¢ºèª)</button>
</div>

<div id="quiz-overlay">
    <div class="quiz-box">
        <h1 style="color:var(--gold); margin-bottom:40px;">å­¦ç§‘è©¦é¨“</h1>
        <p id="q-txt" style="font-size:20px; margin-bottom:30px;"></p>
        <div id="opts"></div>
    </div>
</div>

<div id="flash"></div>
<div id="victory">æ’ƒ ç ´</div>

<script>
    const CONFIG = {
        pHP: 100, bHP: 100, qIdx: 0,
        swOn: false, selected: null,
        wires: [],
        devices: [
            { id: 'PWR', name: 'é›»æº', x: 50, y: 15, terms: ['L', 'N'] },
            { id: 'JB', name: 'Joint Box', x: 50, y: 48, terms: ['1', '2', '3', '4'] },
            { id: 'SW', name: 'ã‚¹ã‚¤ãƒƒãƒ', x: 25, y: 80, terms: ['IN', 'OUT'] },
            { id: 'LMP', name: 'ç…§æ˜', x: 75, y: 80, terms: ['L', 'N'] }
        ],
        quizzes: [
            { q: "æ¥åœ°å´ï¼ˆç™½ç·šï¼‰ã‚’ç¹‹ãã¹ãç«¯å­è¨˜å·ã¯ï¼Ÿ", a: ["L", "W (N)", "E", "S"], c: 1 },
            { q: "éæ¥åœ°å´ï¼ˆé»’ç·šï¼‰ã‚’ã‚¹ã‚¤ãƒƒãƒã¸å…¥ã‚Œã‚‹ç†ç”±ã¯ï¼Ÿ", a: ["é›»åœ§ã‚’åˆ‡ã‚‹ãŸã‚", "è¦‹ãŸç›®", "æŠµæŠ—ã‚’å¢—ã‚„ã™", "ä¸è¦"], c: 0 },
            { q: "VVFã‚±ãƒ¼ãƒ–ãƒ«ã®ã€Œ1.6-2Cã€ã®2Cã¨ã¯ï¼Ÿ", a: ["2cm", "2å›å·»ã", "2å¿ƒ(èŠ¯)", "2ç­‰å…µ"], c: 2 },
            { q: "å·®è¾¼å½¢ã‚³ãƒã‚¯ã‚¿ã®æ¥ç¶šç¢ºèªæ–¹æ³•ã¯ï¼Ÿ", a: ["ç›®è¦–ã¨å¼•å¼µ", "åŒ‚ã„", "éŸ³", "æ„Ÿé›»ã—ã¦ã¿ã‚‹"], c: 0 }
        ]
    };

    function init() {
        showQuiz();
    }

    function showQuiz() {
        if (CONFIG.qIdx >= CONFIG.quizzes.length) {
            document.getElementById('quiz-overlay').style.display = 'none';
            setupStage();
            return;
        }
        const q = CONFIG.quizzes[CONFIG.qIdx];
        document.getElementById('quiz-overlay').style.display = 'flex';
        document.getElementById('q-txt').innerText = `ç¬¬ ${CONFIG.qIdx + 1} å•\n\n${q.q}`;
        const optBox = document.getElementById('opts');
        optBox.innerHTML = '';
        q.a.forEach((t, i) => {
            const b = document.createElement('button');
            b.className = 'opt-btn';
            b.innerText = t;
            b.onclick = () => {
                if (i === q.c) { CONFIG.qIdx++; showQuiz(); }
                else { alert("å­¦ç§‘ä¸åˆæ ¼ï¼ã‚„ã‚Šç›´ã—ï¼"); }
            };
            optBox.appendChild(b);
        });
    }

    function setupStage() {
        document.getElementById('hud').style.display = 'flex';
        document.getElementById('stage').style.display = 'block';
        document.getElementById('controls').style.display = 'flex';
        
        const stage = document.getElementById('stage');
        CONFIG.devices.forEach(d => {
            const div = document.createElement('div');
            div.className = 'device';
            div.style.left = `calc(${d.x}% - 65px)`;
            div.style.top = `${d.y}%`;
            div.innerHTML = `<div class="device-header">${d.name}</div><div class="term-group">` +
                d.terms.map(t => `<div class="term" id="${d.id}-${t}">${t}</div>`).join('') + `</div>`;
            stage.appendChild(div);
        });

        // åˆæœŸé…ç·š (PWR -> JB) ã‚’ç™»éŒ²
        CONFIG.wires = [['PWR-L', 'JB-1'], ['PWR-N', 'JB-2']];
        renderWires();

        document.querySelectorAll('.term').forEach(el => {
            el.onclick = (e) => {
                const tid = e.target.id;
                if (!CONFIG.selected) {
                    CONFIG.selected = tid;
                    e.target.classList.add('active');
                } else {
                    if (CONFIG.selected !== tid) {
                        CONFIG.wires.push([CONFIG.selected, tid]);
                        renderWires();
                    }
                    document.getElementById(CONFIG.selected).classList.remove('active');
                    CONFIG.selected = null;
                }
            };
        });
    }

    function renderWires() {
        const svg = document.getElementById('wire-svg');
        svg.innerHTML = '';
        CONFIG.wires.forEach(pair => {
            const t1 = document.getElementById(pair[0]).getBoundingClientRect();
            const t2 = document.getElementById(pair[1]).getBoundingClientRect();
            const x1 = t1.left + 17, y1 = t1.top + 17;
            const x2 = t2.left + 17, y2 = t2.top + 17;

            const isWhite = pair[0].includes('-N') || pair[1].includes('-N') || pair[1] === 'JB-2';
            
            // å¤–è£…ã‚±ãƒ¼ãƒ–ãƒ«
            const lineO = document.createElementNS("http://www.w3.org/2000/svg", "line");
            lineO.setAttribute("x1", x1); lineO.setAttribute("y1", y1);
            lineO.setAttribute("x2", x2); lineO.setAttribute("y2", y2);
            lineO.setAttribute("stroke", "#444");
            lineO.setAttribute("class", "cable");
            svg.appendChild(lineO);

            // å¿ƒç·š (é»’ or ç™½)
            const lineI = document.createElementNS("http://www.w3.org/2000/svg", "line");
            lineI.setAttribute("x1", x1); lineI.setAttribute("y1", y1);
            lineI.setAttribute("x2", x2); lineI.setAttribute("y2", y2);
            lineI.setAttribute("stroke", isWhite ? "#eee" : "#000");
            lineI.setAttribute("class", "cable-inner");
            lineI.id = `flow-${pair[0]}-${pair[1]}`;
            svg.appendChild(lineI);
        });
    }

    function toggleSW() {
        CONFIG.swOn = !CONFIG.swOn;
        document.getElementById('sw-btn').innerText = `SWITCH: ${CONFIG.swOn ? 'ON' : 'OFF'}`;
        document.getElementById('sw-btn').style.background = CONFIG.swOn ? '#444' : '#222';
    }

    function resetGame() {
        CONFIG.wires = [['PWR-L', 'JB-1'], ['PWR-N', 'JB-2']];
        renderWires();
    }

    function checkFinal() {
        if (!CONFIG.swOn) { alert("ã‚¹ã‚¤ãƒƒãƒã‚’å…¥ã‚Œã‚ï¼"); return; }
        
        // å°é€šåˆ¤å®š (ç°¡æ˜“ã‚°ãƒ©ãƒ•æ¢ç´¢)
        const adj = {};
        CONFIG.wires.forEach(([a, b]) => {
            if (!adj[a]) adj[a] = []; if (!adj[b]) adj[b] = [];
            adj[a].push(b); adj[b].push(a);
        });
        if (CONFIG.swOn) {
            if (!adj['SW-IN']) adj['SW-IN'] = []; if (!adj['SW-OUT']) adj['SW-OUT'] = [];
            adj['SW-IN'].push('SW-OUT'); adj['SW-OUT'].push('SW-IN');
        }

        let success = false;
        const visited = new Set();
        const stack = [['PWR-L', false]];
        while(stack.length > 0) {
            const [curr, passedLmp] = stack.pop();
            if (curr === 'PWR-N' && passedLmp) { success = true; break; }
            visited.add(curr);
            const isLmp = curr.startsWith('LMP');
            (adj[curr] || []).forEach(next => {
                if (!visited.has(next)) stack.push([next, passedLmp || isLmp]);
            });
        }

        if (success) {
            document.querySelectorAll('.cable-inner').forEach(l => l.classList.add('gold-run'));
            setTimeout(() => {
                CONFIG.bHP -= 34;
                document.getElementById('b-hp').style.width = CONFIG.bHP + '%';
                if (CONFIG.bHP <= 0) {
                    document.getElementById('flash').style.display = 'block';
                    setTimeout(() => { 
                        document.getElementById('victory').style.display = 'flex';
                    }, 200);
                } else {
                    alert("é€šé›»ï¼ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼");
                    document.querySelectorAll('.cable-inner').forEach(l => l.classList.remove('gold-run'));
                }
            }, 800);
        } else {
            alert("ä¸ç‚¹ç¯ï¼é…ç·šãƒŸã‚¹ã ï¼");
        }
    }

    window.onload = init;
</script>
</body>
</html>
