<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>ä¿ºã‚‰ã®é›»å·¥ - GOD CONNECTION</title>
<style>
/* å…±é€šãƒªã‚»ãƒƒãƒˆï¼†ãƒ™ãƒ¼ã‚¹ */
* { box-sizing: border-box; user-select: none; }
body { margin: 0; padding: 0; background: #000; color: #fff; font-family: 'Helvetica Neue', Arial, sans-serif; overflow: hidden; touch-action: none; }

/* ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
.hidden { display: none !important; }
@keyframes pulseGlow { 0% { text-shadow: 0 0 10px #ffd000, 0 0 20px #ffd000; } 50% { text-shadow: 0 0 20px #ffd000, 0 0 40px #ffaa00; } 100% { text-shadow: 0 0 10px #ffd000, 0 0 20px #ffd000; } }
@keyframes shake { 0%, 100% { transform: translateX(0); } 20% { transform: translateX(-15px) rotate(-5deg); } 40% { transform: translateX(15px) rotate(5deg); } 60% { transform: translateX(-15px) rotate(-5deg); } 80% { transform: translateX(15px) rotate(5deg); } }
@keyframes flashRed { 0% { background: rgba(255,0,0,0.8); } 100% { background: transparent; } }
@keyframes flowDash { from { stroke-dashoffset: 40; } to { stroke-dashoffset: 0; } }
@keyframes dropImpact { 0% { transform: scale(5); opacity: 0; } 50% { transform: scale(1); opacity: 1; } 100% { transform: scale(1); opacity: 1; } }

/* --- 1. ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ --- */
#titleScreen { position: fixed; inset: 0; background: radial-gradient(circle, #222 0%, #000 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 50000; }
.title-logo { font-size: 50px; font-weight: 900; color: #ffd000; animation: pulseGlow 2s infinite; margin-bottom: 5px; }
.title-sub { font-size: 16px; color: #fff; letter-spacing: 5px; margin-bottom: 30px; }
.presents { font-size: 14px; color: #aaa; margin-bottom: 50px; }
.btn-gold { padding: 15px 50px; font-size: 20px; font-weight: bold; background: linear-gradient(180deg, #ffe066 0%, #d4af37 100%); color: #000; border: none; border-radius: 30px; box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4); cursor: pointer; }
.btn-gold:active { transform: scale(0.95); }

/* --- 2. ã‚¯ã‚¤ã‚ºç”»é¢ --- */
#quizScreen { position: fixed; inset: 0; background: #111; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 40000; padding: 20px; text-align: center; }
.quiz-q { font-size: 20px; margin-bottom: 30px; line-height: 1.5; color: #ffd000; }
.quiz-btn { width: 100%; max-width: 300px; padding: 15px; margin: 8px 0; background: #333; color: #fff; border: 2px solid #555; border-radius: 10px; font-size: 16px; font-weight: bold; }
.quiz-btn:active { background: #ffd000; color: #000; }

/* --- 3. é…ç·šãƒ‘ãƒ¼ãƒˆ (Game Screen) --- */
#gameScreen { position: fixed; inset: 0; display: flex; flex-direction: column; }
#board { flex: 1; position: relative; width: 100%; background: #000; }
#wireLayer { position: absolute; inset: 0; width: 100%; height: 100%; z-index: 10; pointer-events: none; }

/* ãƒ‡ãƒã‚¤ã‚¹é¡ (ä½ç½®ã¯JSã§è¨­å®š) */
.device { position: absolute; background: #e0e0e0; color: #000; border-radius: 8px; border: 2px solid #555; padding: 10px; text-align: center; z-index: 5; box-shadow: 0 4px 10px rgba(0,0,0,0.5); transform: translate(-50%, -50%); display: flex; flex-direction: column; align-items: center; min-width: 90px; }
.dev-title { font-size: 12px; font-weight: bold; border-bottom: 1px solid #999; margin-bottom: 5px; width: 100%; }
.dev-icon { font-size: 24px; margin: 5px 0; display: flex; align-items: center; justify-content: center; height: 30px; }
.term-row { display: flex; justify-content: center; gap: 10px; margin-top: 5px; }

/* ç«¯å­ */
.term { width: 30px; height: 30px; background: #222; color: #fff; border: 2px solid #000; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: bold; z-index: 20; position: relative; cursor: pointer; }
.term.sel { background: #ffd000; color: #000; border-color: #fff; box-shadow: 0 0 10px #ffd000; transform: scale(1.1); }

/* é…ç·šæç”»ã‚¹ã‚¿ã‚¤ãƒ« */
.wire-path { fill: none; stroke-linecap: round; stroke-linejoin: round; }
.wire-white { stroke: #fff; stroke-width: 6; }
/* é»’ç·šã¯ãƒ€ãƒ¼ã‚¯ã‚°ãƒ¬ãƒ¼ã«ã—ã¦ç™½ã®ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ã¤ã‘ã‚‹ã“ã¨ã§é»’èƒŒæ™¯ã§ã‚‚è¦–èªå¯èƒ½ã« */
.wire-black { stroke: #444; stroke-width: 8; filter: drop-shadow(0 0 2px rgba(255,255,255,0.7)); }
.wire-glow { stroke: #ffd000; stroke-width: 6; stroke-dasharray: 10, 15; animation: flowDash 0.5s linear infinite; display: none; }

/* ä¸‹éƒ¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« */
#controls { height: 100px; background: #1a1a1a; display: flex; justify-content: center; align-items: center; gap: 15px; border-top: 2px solid #333; z-index: 30; position: relative; padding: 0 10px; }
.btn-ctrl { padding: 12px 20px; font-size: 14px; font-weight: bold; background: #444; color: #fff; border: none; border-radius: 5px; }
.btn-set { padding: 15px 40px; font-size: 18px; font-weight: 900; background: #ffd000; color: #000; border: none; border-radius: 8px; }

/* æ¼”å‡ºãƒ¬ã‚¤ãƒ¤ãƒ¼ */
#overlayMsg { position: fixed; inset: 0; pointer-events: none; display: flex; align-items: center; justify-content: center; font-size: 60px; font-weight: 900; color: #ffd000; text-shadow: 0 0 20px #ff0000; z-index: 35000; opacity: 0; transition: opacity 0.3s; }

/* --- 4. ãƒœã‚¹ãƒ‘ãƒ¼ãƒˆç”»é¢ --- */
#bossScreen { position: fixed; inset: 0; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 45000; }
.boss-title { color: #ff3333; font-size: 24px; font-weight: bold; margin-bottom: 20px; }
.boss-img { font-size: 120px; margin-bottom: 30px; filter: drop-shadow(0 0 20px #ff0000); }
.hp-frame { width: 80%; max-width: 400px; height: 25px; background: #222; border: 2px solid #555; border-radius: 15px; overflow: hidden; position: relative; }
.hp-bar { height: 100%; width: 100%; background: linear-gradient(90deg, #ff0000, #ff6600); transition: width 0.5s ease-out; }
#damageFlash { position: absolute; inset: 0; background: rgba(255,0,0,0.5); z-index: 46000; pointer-events: none; opacity: 0; }

/* --- 5. ãƒ—ãƒãƒ¥ãƒ³ï¼ˆæ’ƒç ´ï¼‰æ¼”å‡º --- */
#puchunScreen { position: fixed; inset: 0; background: #000; z-index: 60000; display: flex; align-items: center; justify-content: center; }
.puchun-text { font-size: 80px; font-weight: 900; color: #ffd000; text-shadow: 0 0 30px #ffd000, 0 0 50px #ff0000; animation: dropImpact 0.5s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
</style>
</head>
<body>

<div id="titleScreen">
    <div class="title-logo">ä¿ºã‚‰ã®é›»å·¥</div>
    <div class="title-sub">GOD CONNECTION</div>
    <div class="presents">presents by è²´é›»</div>
    <button class="btn-gold" onclick="startQuiz()">ç¾å ´å…¥ã‚Š</button>
</div>

<div id="quizScreen" class="hidden">
    <div style="color:#aaa; margin-bottom:10px;" id="qCount">ç¬¬ 1 / 5 å•</div>
    <div class="quiz-q" id="qText">å•é¡Œæ–‡</div>
    <div id="ansBox"></div>
</div>

<div id="gameScreen" class="hidden">
    <div style="position:absolute; top:10px; right:15px; color:#ff3333; font-weight:bold; z-index:30;">BOSS HP: <span id="miniBossHP">3</span></div>
    <div id="board">
        <svg id="wireLayer"></svg>
        
        <div class="device" id="dev-p" style="top: 15%; left: 50%;">
            <div class="dev-title">é›»æº</div>
            <div class="dev-icon">ğŸšï¸</div>
            <div class="term-row">
                <div class="term" data-id="p-L">L</div>
                <div class="term" data-id="p-N">N</div>
            </div>
        </div>
        
        <div class="device" id="dev-jb" style="top: 45%; left: 50%;">
            <div class="dev-title">Joint Box</div>
            <div class="term-row" style="flex-wrap: wrap; width: 80px;">
                <div class="term" data-id="j1">1</div>
                <div class="term" data-id="j2">2</div>
                <div class="term" data-id="j3">3</div>
                <div class="term" data-id="j4">4</div>
            </div>
        </div>

        <div class="device" id="dev-sw" style="top: 75%; left: 25%;">
            <div class="dev-title">ã‚¹ã‚¤ãƒƒãƒ</div>
            <div class="dev-icon">ğŸ”˜</div>
            <div class="term-row">
                <div class="term" data-id="s-i">IN</div>
                <div class="term" data-id="s-o">OUT</div>
            </div>
        </div>

        <div class="device" id="dev-lp" style="top: 75%; left: 75%;">
            <div class="dev-title">ç…§æ˜</div>
            <div class="dev-icon">ğŸ’¡</div>
            <div class="term-row">
                <div class="term" data-id="l-L">L</div>
                <div class="term" data-id="l-N">N</div>
            </div>
        </div>
    </div>
    <div id="controls">
        <button class="btn-ctrl" onclick="resetWires()">ãƒªã‚»ãƒƒãƒˆ</button>
        <button class="btn-set" onclick="checkSet()">SET (é€šé›»ç¢ºèª)</button>
    </div>
</div>

<div id="overlayMsg">æ­£è§£ï¼</div>

<div id="bossScreen" class="hidden">
    <div id="damageFlash"></div>
    <div class="boss-title">é«˜é›»åœ§é­”ç¥ ã‚¢ãƒ¼ã‚¯</div>
    <div class="boss-img" id="bossImg">ğŸ‘º</div>
    <div class="hp-frame">
        <div class="hp-bar" id="bossHPBar"></div>
    </div>
</div>

<div id="puchunScreen" class="hidden"></div>

<script>
// --- ã‚¯ã‚¤ã‚ºãƒ‡ãƒ¼ã‚¿ ---
const quizzes = [
    {q: "æ¥åœ°å´ï¼ˆç™½ç·šï¼‰ã‚’ç¹‹ãã¹ãç«¯å­è¨˜å·ã¯ï¼Ÿ", a: ["L", "W (N)", "E", "S"], c: 1},
    {q: "é›»åœ§å´ï¼ˆé»’ç·šï¼‰ã‚’ã‚¹ã‚¤ãƒƒãƒã«å…¥ã‚Œã‚‹ç†ç”±ã¯ï¼Ÿ", a: ["é›»åœ§ã‚’åˆ‡ã‚‹ãŸã‚", "è‰²ã‚’åˆã‚ã›ã‚‹ãŸã‚", "é›»æ°—ã‚’è²¯ã‚ã‚‹ãŸã‚", "ç‰¹ã«ç†ç”±ã¯ãªã„"], c: 0},
    {q: "å›è·¯å›³ã§ã€â—ã€ã®ä¸­ã«ã€Lã€ã¨æ›¸ã„ã¦ã‚ã‚‹ã‚‚ã®ã¯ï¼Ÿ", a: ["ã‚³ãƒ³ã‚»ãƒ³ãƒˆ", "ç¢ºèªè¡¨ç¤ºç¯", "ä½ç½®è¡¨ç¤ºç¯", "ãƒ‘ã‚¤ãƒ­ãƒƒãƒˆãƒ©ãƒ³ãƒ—"], c: 2},
    {q: "çµ¶ç¸æŠµæŠ—ã®æ¸¬å®šã«ä½¿ç”¨ã™ã‚‹å™¨å…·ã¯ï¼Ÿ", a: ["ãƒ†ã‚¹ã‚¿", "ã‚¯ãƒ©ãƒ³ãƒ—ãƒ¡ãƒ¼ã‚¿", "ãƒ¡ã‚¬ãƒ¼", "æ¤œé›»å™¨"], c: 2},
    {q: "é…ç·šç”¨é®æ–­å™¨ã®å½¹å‰²ã¯ï¼Ÿ", a: ["é›»åœ§ã‚’ä¸Šã’ã‚‹", "æ¼é›»ã‚’é˜²ã", "éé›»æµã‚’é®æ–­ã™ã‚‹", "é›»åŠ›ã‚’æ¸¬å®šã™ã‚‹"], c: 2}
];

let qIdx = 0;
let bossHP = 3; // ãƒœã‚¹ã®HPï¼ˆ3å›ã®é…ç·šã‚¯ãƒªã‚¢ã§æ’ƒç ´ï¼‰

// --- ç”»é¢åˆ‡ã‚Šæ›¿ãˆ ---
const el = id => document.getElementById(id);
const hide = id => el(id).classList.add('hidden');
const show = id => el(id).classList.remove('hidden');

// --- é€²è¡Œãƒ­ã‚¸ãƒƒã‚¯ ---
function startQuiz() {
    hide('titleScreen');
    show('quizScreen');
    loadQuiz();
}

function loadQuiz() {
    if (qIdx >= quizzes.length) {
        hide('quizScreen');
        show('gameScreen');
        initWiring();
        return;
    }
    const q = quizzes[qIdx];
    el('qCount').innerText = `ç¬¬ ${qIdx + 1} / 5 å•`;
    el('qText').innerText = q.q;
    const box = el('ansBox');
    box.innerHTML = '';
    q.a.forEach((txt, i) => {
        const btn = document.createElement('button');
        btn.className = 'quiz-btn';
        btn.innerText = txt;
        btn.onclick = () => {
            if (i === q.c) { qIdx++; loadQuiz(); }
            else { alert("ä¸æ­£è§£ï¼é›†ä¸­ã—ã‚ï¼"); }
        };
        box.appendChild(btn);
    });
}

// --- é…ç·šãƒ­ã‚¸ãƒƒã‚¯ ---
let lines = [];
let selTerm = null;

function initWiring() {
    lines = [];
    selTerm = null;
    drawWires();
    
    // ç«¯å­ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆé‡è¤‡ç™»éŒ²ã‚’é˜²ããŸã‚ä¸€åº¦ã‚¯ãƒªã‚¢ï¼‰
    document.querySelectorAll('.term').forEach(t => {
        t.onclick = null;
        t.classList.remove('sel');
        t.onclick = (e) => handleTermClick(e.target);
    });
}

function handleTermClick(term) {
    if (!selTerm) {
        selTerm = term;
        term.classList.add('sel');
    } else {
        if (selTerm !== term && selTerm.dataset.id !== term.dataset.id) {
            lines.push([selTerm.dataset.id, term.dataset.id]);
        }
        selTerm.classList.remove('sel');
        selTerm = null;
        drawWires();
    }
}

function resetWires() {
    lines = [];
    if(selTerm) selTerm.classList.remove('sel');
    selTerm = null;
    drawWires();
}

function drawWires() {
    const svg = el('wireLayer');
    const boardRect = el('board').getBoundingClientRect();
    svg.innerHTML = '';
    
    lines.forEach((l, index) => {
        const t1 = document.querySelector(`[data-id="${l[0]}"]`);
        const t2 = document.querySelector(`[data-id="${l[1]}"]`);
        if (!t1 || !t2) return;

        const r1 = t1.getBoundingClientRect();
        const r2 = t2.getBoundingClientRect();
        
        // svgå†…ã®ç›¸å¯¾åº§æ¨™ã«å¤‰æ›
        const x1 = r1.left - boardRect.left + r1.width / 2;
        const y1 = r1.top - boardRect.top + r1.height / 2;
        const x2 = r2.left - boardRect.left + r2.width / 2;
        const y2 = r2.top - boardRect.top + r2.height / 2;

        // é»’ç·šï¼ˆéæ¥åœ°å´ãƒ»ã‚¹ã‚¤ãƒƒãƒç·šï¼‰åˆ¤å®š
        const isBlack = l[0].match(/L|i|o/) || l[1].match(/L|i|o/);
        
        // æç”» (é‡ãªã‚Šã‚’å°‘ã—é¿ã‘ã‚‹ãŸã‚ã«ã‚«ãƒ¼ãƒ–Qã‚’ä½¿ç”¨)
        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        const offset = (index % 2 === 0) ? 15 : -15; // äº¤äº’ã«è†¨ã‚‰ã¾ã›ã‚‹
        const cx = (x1 + x2) / 2 + offset;
        const cy = (y1 + y2) / 2 + offset;
        const d = `M ${x1} ${y1} Q ${cx} ${cy} ${x2} ${y2}`;
        
        path.setAttribute("d", d);
        path.setAttribute("class", `wire-path ${isBlack ? 'wire-black' : 'wire-white'}`);
        svg.appendChild(path);

        // é›»æµã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨
        const glow = document.createElementNS("http://www.w3.org/2000/svg", "path");
        glow.setAttribute("d", d);
        glow.setAttribute("class", "wire-path wire-glow");
        svg.appendChild(glow);
    });
}

// --- åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ (è¶…å³æ ¼) ---
function checkSet() {
    // ã‚°ãƒ©ãƒ•æ§‹ç¯‰
    const adj = {};
    const addEdge = (u, v) => {
        if(!adj[u]) adj[u] = []; if(!adj[v]) adj[v] = [];
        adj[u].push(v); adj[v].push(u);
    };
    lines.forEach(l => addEdge(l[0], l[1]));

    // æ¢ç´¢é–¢æ•° (æŒ‡å®šã—ãŸå§‹ç‚¹ã‹ã‚‰ç¹‹ãŒã£ã¦ã„ã‚‹ç«¯å­ã®é…åˆ—ã‚’è¿”ã™)
    function getNet(start) {
        if (!adj[start]) return [start];
        const visited = new Set();
        const q = [start];
        while(q.length > 0) {
            const node = q.shift();
            if(!visited.has(node)) {
                visited.add(node);
                (adj[node] || []).forEach(n => q.push(n));
            }
        }
        return Array.from(visited);
    }

    const netL = getNet('p-L');
    const netSW = getNet('s-o');
    const netN = getNet('p-N');

    // æ­£è§£æ¡ä»¶:
    // 1. p-L ãŒ s-i ã«ç¹‹ãŒã£ã¦ã„ã‚‹
    // 2. s-o ãŒ l-L ã«ç¹‹ãŒã£ã¦ã„ã‚‹
    // 3. l-N ãŒ p-N ã«ç¹‹ãŒã£ã¦ã„ã‚‹
    // 4. ã‚·ãƒ§ãƒ¼ãƒˆã—ã¦ã„ãªã„ã“ã¨ï¼ˆå„ãƒãƒƒãƒˆãŒä»–ã®é‡è¦ç«¯å­ã‚’å«ã¾ãªã„ï¼‰
    const isCorrect = 
        netL.includes('s-i') && 
        netSW.includes('l-L') && 
        netN.includes('l-N') &&
        !netL.includes('p-N') && !netL.includes('l-N') && !netL.includes('s-o') &&
        !netSW.includes('p-N') && !netSW.includes('p-L') && !netSW.includes('l-N') &&
        !netN.includes('p-L') && !netN.includes('s-i') && !netN.includes('s-o');

    if (isCorrect) {
        // é€šé›»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        document.querySelectorAll('.wire-glow').forEach(el => el.style.display = 'block');
        el('overlayMsg').style.opacity = '1';
        
        setTimeout(() => {
            el('overlayMsg').style.opacity = '0';
            document.querySelectorAll('.wire-glow').forEach(el => el.style.display = 'none');
            triggerBossDamage();
        }, 1500);
    } else {
        alert("ä¸ç‚¹ç¯... æ–­ç·šã‹ã‚·ãƒ§ãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚å›è·¯ã‚’è¦‹ç›´ã—ã¦ãã ã•ã„ã€‚");
    }
}

// --- ãƒœã‚¹æ¼”å‡º ---
function triggerBossDamage() {
    hide('gameScreen');
    show('bossScreen');
    
    // HPãƒãƒ¼æ›´æ–°
    bossHP--;
    const hpPct = (bossHP / 3) * 100;
    el('bossHPBar').style.width = hpPct + '%';
    
    // ãƒ€ãƒ¡ãƒ¼ã‚¸æ¼”å‡º
    const bossImg = el('bossImg');
    const flash = el('damageFlash');
    
    bossImg.style.animation = 'shake 0.4s';
    flash.style.animation = 'flashRed 0.4s';
    
    setTimeout(() => {
        bossImg.style.animation = '';
        flash.style.animation = '';
        
        if (bossHP <= 0) {
            triggerPuchun();
        } else {
            // æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¸æˆ»ã‚‹
            el('miniBossHP').innerText = bossHP;
            hide('bossScreen');
            show('gameScreen');
            resetWires();
        }
    }, 1500);
}

// --- ãƒŸãƒªã‚ªãƒ³ã‚´ãƒƒãƒˆé¢¨ãƒ—ãƒãƒ¥ãƒ³æ¼”å‡º ---
function triggerPuchun() {
    // ç”»é¢å…¨ä½“ã‚’å³ãƒ–ãƒ©ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
    hide('bossScreen');
    hide('gameScreen');
    hide('titleScreen');
    hide('quizScreen');
    
    const pScreen = el('puchunScreen');
    show('puchunScreen');
    pScreen.innerHTML = ''; // ä¸€æ—¦ç©ºã«ã—ã¦ç´”é»’ã‚’ç¶­æŒ
    
    // 3ç§’ã®ã€Œé™å¯‚ã€ã®å¾Œã«é™è‡¨
    setTimeout(() => {
        const text = document.createElement('div');
        text.className = 'puchun-text';
        text.innerText = 'æ’ƒç ´';
        pScreen.appendChild(text);
    }, 3000);
}
</script>
</body>
</html>
