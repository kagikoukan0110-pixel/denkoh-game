<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è¤‡ç·šå›³ãƒ¢ãƒ¼ãƒ‰ - æœ¬ç‰©è§£æv6</title>
<style>
body{
  text-align:center;
  font-family:sans-serif;
  background:#f0f0f0;
  margin:0;
}
#board{
  width:360px;
  height:500px;
  margin:20px auto;
  background:white;
  border:2px solid black;
  position:relative;
}
.node{
  width:80px;height:40px;border:2px solid black;
  text-align:center;line-height:40px;
  position:absolute;background:#ddd;
}
.terminal{
  width:18px;height:18px;border-radius:50%;
  background:black;position:absolute;cursor:pointer;
  transition:0.2s;
}
.selected{ outline:3px solid red; }
.jb{
  width:120px;height:120px;border:3px solid #333;
  position:absolute;top:190px;left:120px;background:#fafafa;
}
#message{ font-size:20px;font-weight:bold;margin-top:10px; }
button{ margin:4px;padding:6px 10px; }
#legend{ font-size:13px;margin-top:6px;color:#555; }
</style>
</head>
<body>

<h2>âš¡ è¤‡ç·šå›³ãƒ¢ãƒ¼ãƒ‰ - æœ¬ç‰©è§£æv6</h2>

<div id="board">

  <!-- é›»æº -->
  <div class="node" style="top:40px; left:20px;">é›»æº</div>
  <div class="terminal" data-id="L" style="top:90px; left:50px;"></div>
  <div class="terminal" data-id="N" style="top:120px; left:50px;"></div>

  <!-- ã‚¹ã‚¤ãƒƒãƒ -->
  <div class="node" style="top:40px; left:250px;">SW</div>
  <div class="terminal" data-id="SW1" style="top:90px; left:280px;"></div>
  <div class="terminal" data-id="SW2" style="top:120px; left:280px;"></div>

  <!-- ãƒ©ãƒ³ãƒ— -->
  <div class="node" style="top:400px; left:140px;">ãƒ©ãƒ³ãƒ—</div>
  <div class="terminal" data-id="Lamp1" style="top:360px; left:165px;"></div>
  <div class="terminal" data-id="Lamp2" style="top:360px; left:195px;"></div>

  <!-- JB -->
  <div class="jb"></div>
  <div class="terminal" data-id="JB1" style="top:210px; left:140px;"></div>
  <div class="terminal" data-id="JB2" style="top:210px; left:190px;"></div>
  <div class="terminal" data-id="JB3" style="top:210px; left:240px;"></div>
  <div class="terminal" data-id="JB4" style="top:260px; left:140px;"></div>
  <div class="terminal" data-id="JB5" style="top:260px; left:190px;"></div>
  <div class="terminal" data-id="JB6" style="top:260px; left:240px;"></div>

</div>

<div>
  <button onclick="bundle()">æŸã­ã‚‹</button>
  <button onclick="analyze()">è§£æï¼ˆSW ONï¼‰</button>
  <button onclick="resetGame()">ãƒªã‚»ãƒƒãƒˆ</button>
</div>

<div id="message"></div>
<div id="legend">â€» è§£æã¯ã‚¹ã‚¤ãƒƒãƒONçŠ¶æ…‹ã§é›»æµçµŒè·¯ã‚’æ¢ç´¢ã—ã¾ã™ã€‚</div>

<script>
let selectedTerminals=[];
let parent={};
const terminals = () => Array.from(document.querySelectorAll(".terminal"));
const message = document.getElementById("message");

// ===== Union-Find =====
function init(){
  parent={};
  terminals().forEach(t=>{
    parent[t.dataset.id]=t.dataset.id;
    t.style.background="black";
    t.classList.remove("selected");
  });
}
init();

function find(x){
  if(parent[x]!==x){
    parent[x]=find(parent[x]);
  }
  return parent[x];
}
function union(a,b){
  let pa=find(a);
  let pb=find(b);
  if(pa!==pb) parent[pb]=pa;
}

// ===== ç«¯å­é¸æŠ =====
terminals().forEach(t=>{
  t.addEventListener("click",()=>{
    if(selectedTerminals.includes(t)){
      t.classList.remove("selected");
      selectedTerminals=selectedTerminals.filter(x=>x!==t);
    }else{
      t.classList.add("selected");
      selectedTerminals.push(t);
    }
  });
});

// ===== æŸã­ã‚‹ =====
function bundle(){
  if(selectedTerminals.length<2) return;

  const base = selectedTerminals[0].dataset.id;
  selectedTerminals.forEach(t=> union(base, t.dataset.id));

  recolorGroups();

  selectedTerminals.forEach(t=> t.classList.remove("selected"));
  selectedTerminals=[];
}

// ===== ã‚°ãƒ«ãƒ¼ãƒ—è‰²åˆ†ã‘ï¼ˆrootã”ã¨ã«è‰²å‰²å½“ï¼‰=====
function recolorGroups(){
  const roots = {};
  terminals().forEach(t=>{
    const r = find(t.dataset.id);
    if(!roots[r]) roots[r] = randomColor(r);
  });
  terminals().forEach(t=>{
    const r = find(t.dataset.id);
    t.style.background = roots[r];
  });
}

// rootã«å®‰å®šè‰²ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ˆæ¯å›åŒã˜è‰²ã«ãªã‚Šã‚„ã™ã„ç°¡æ˜“æ³•ï¼‰
function randomColor(seed){
  let hash=0;
  for(let i=0;i<seed.length;i++){
    hash = seed.charCodeAt(i) + ((hash<<5)-hash);
  }
  const h = Math.abs(hash)%360;
  return `hsl(${h},70%,50%)`;
}

// ===== é›»æµãƒ•ãƒ­ãƒ¼è§£æ =====
function analyze(){
  message.innerText="";

  // ã‚·ãƒ§ãƒ¼ãƒˆæ¤œå‡ºï¼ˆLã¨NãŒåŒä¸€ãƒãƒ¼ãƒ‰ï¼‰
  if(find("L")===find("N")){
    message.innerText="ğŸ”¥ L-Nã‚·ãƒ§ãƒ¼ãƒˆï¼æ¬ é™¥ï¼";
    return;
  }

  // ã‚°ãƒ©ãƒ•æ§‹ç¯‰ï¼ˆãƒãƒ¼ãƒ‰=å„rootï¼‰
  const graph = {};
  terminals().forEach(t=>{
    const r = find(t.dataset.id);
    if(!graph[r]) graph[r]=new Set();
  });

  // åŒä¸€rootã¯åŒä¸€ãƒãƒ¼ãƒ‰ï¼ˆã™ã§ã«çµ±åˆæ¸ˆï¼‰
  // ã‚¹ã‚¤ãƒƒãƒONã¨ã—ã¦ SW1-SW2 ã‚’ä»®æƒ³æ¥ç¶š
  const rSW1 = find("SW1");
  const rSW2 = find("SW2");
  if(!graph[rSW1]) graph[rSW1]=new Set();
  if(!graph[rSW2]) graph[rSW2]=new Set();
  graph[rSW1].add(rSW2);
  graph[rSW2].add(rSW1);

  // æ¢ç´¢ï¼šLã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¦Lamp1ã«åˆ°é”ã§ãã‚‹ã‹
  const start = find("L");
  const target = find("Lamp1");
  const visited = new Set();
  const queue = [start];

  while(queue.length){
    const cur = queue.shift();
    if(cur===target) break;
    visited.add(cur);

    // åŒä¸€ã‚°ãƒ«ãƒ¼ãƒ—å†…ã¯åŒä¸€ãƒãƒ¼ãƒ‰æ‰±ã„ãªã®ã§
    // è¿½åŠ æ¥ç¶šï¼ˆSWå†…éƒ¨ï¼‰ã ã‘æ¢ç´¢
    if(graph[cur]){
      graph[cur].forEach(next=>{
        if(!visited.has(next)) queue.push(next);
      });
    }
  }

  if(!visited.has(target) && start!==target){
    message.innerText="âŒ Lã‹ã‚‰ãƒ©ãƒ³ãƒ—ã¸åˆ°é”ã§ããªã„";
    return;
  }

  // Lamp2ã‹ã‚‰Nã¸åˆ°é”ç¢ºèª
  if(find("Lamp2")!==find("N")){
    message.innerText="âŒ ãƒ©ãƒ³ãƒ—ç™½å´ãŒNã«æ¥ç¶šã•ã‚Œã¦ã„ãªã„";
    return;
  }

  message.innerText="ğŸ’¡ æ­£è§£ï¼é›»æµçµŒè·¯æˆç«‹ï¼";
}

// ===== ãƒªã‚»ãƒƒãƒˆ =====
function resetGame(){
  selectedTerminals=[];
  message.innerText="";
  init();
}
</script>

</body>
</html>
