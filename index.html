<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é›»å·¥æŠ€èƒ½è©¦é¨“ãƒ¢ãƒ¼ãƒ‰ - å®Œå…¨ç‰ˆ</title>
<style>
body{ text-align:center;font-family:sans-serif;background:#f2f2f2;margin:0;}
#board{ width:380px;height:560px;margin:20px auto;background:white;border:3px solid black;position:relative;}
.node{ width:90px;height:40px;border:2px solid black;text-align:center;line-height:40px;position:absolute;background:#ddd;font-weight:bold;}
.terminal{ width:20px;height:20px;border-radius:50%;position:absolute;cursor:pointer;border:2px solid #333;}
.black{ background:black;}
.white{ background:white;}
.selected{ outline:3px solid red;}
.jb{ width:140px;height:140px;border:3px solid #333;position:absolute;top:210px;left:120px;background:#fafafa;}
.line{ position:absolute;height:4px;transform-origin:0 0;}
#message{ font-size:18px;font-weight:bold;margin-top:10px;white-space:pre-line;}
button{ margin:5px;padding:8px 14px;}
#answer{ font-size:14px;margin-top:5px;color:#444;}
</style>
</head>
<body>

<h2>âš¡ é›»å·¥æŠ€èƒ½è©¦é¨“ãƒ¢ãƒ¼ãƒ‰ - å®Œå…¨ç‰ˆ</h2>

<div id="board">

<div class="node" style="top:40px; left:20px;">é›»æº</div>
<div class="terminal black" data-id="L" data-color="black" style="top:90px; left:60px;"></div>
<div class="terminal white" data-id="N" data-color="white" style="top:120px; left:60px;"></div>

<div class="node" style="top:40px; left:260px;">SW</div>
<div class="terminal black" data-id="SW1" data-color="black" style="top:90px; left:300px;"></div>
<div class="terminal black" data-id="SW2" data-color="black" style="top:120px; left:300px;"></div>

<div class="node" style="top:470px; left:150px;">ãƒ©ãƒ³ãƒ—</div>
<div class="terminal black" data-id="Lamp1" data-color="black" style="top:430px; left:170px;"></div>
<div class="terminal white" data-id="Lamp2" data-color="white" style="top:430px; left:210px;"></div>

<div class="jb"></div>

<div class="terminal black" data-id="JB1" data-jb="true" style="top:230px; left:150px;"></div>
<div class="terminal black" data-id="JB2" data-jb="true" style="top:230px; left:200px;"></div>
<div class="terminal black" data-id="JB3" data-jb="true" style="top:230px; left:250px;"></div>
<div class="terminal black" data-id="JB4" data-jb="true" style="top:280px; left:150px;"></div>
<div class="terminal black" data-id="JB5" data-jb="true" style="top:280px; left:200px;"></div>
<div class="terminal black" data-id="JB6" data-jb="true" style="top:280px; left:250px;"></div>

</div>

<button onclick="analyze()">è§£æï¼ˆSW ONï¼‰</button>
<button onclick="resetGame()">ãƒªã‚»ãƒƒãƒˆ</button>

<div id="message"></div>
<div id="answer"></div>

<script>

let selected=[];
let parent={};
let connections={};
const board=document.getElementById("board");

function init(){
  parent={};
  connections={};
  document.querySelectorAll(".terminal").forEach(t=>{
    parent[t.dataset.id]=t.dataset.id;
    connections[t.dataset.id]=[];
    t.classList.remove("selected");
  });
  document.querySelectorAll(".line").forEach(l=>l.remove());
}
init();

function find(x){
  if(parent[x]!==x) parent[x]=find(parent[x]);
  return parent[x];
}

function union(a,b){
  let pa=find(a);
  let pb=find(b);
  if(pa!==pb) parent[pb]=pa;
  connections[a].push(b);
  connections[b].push(a);
}

function drawLine(a,b){
  const ra=a.getBoundingClientRect();
  const rb=b.getBoundingClientRect();
  const rBoard=board.getBoundingClientRect();

  const x1=ra.left-rBoard.left+10;
  const y1=ra.top-rBoard.top+10;
  const x2=rb.left-rBoard.left+10;
  const y2=rb.top-rBoard.top+10;

  const len=Math.hypot(x2-x1,y2-y1);

  const line=document.createElement("div");
  line.className="line";
  line.style.left=x1+"px";
  line.style.top=y1+"px";
  line.style.width=len+"px";

  const color = (a.dataset.color==="white"||b.dataset.color==="white")?"white":"black";
  line.style.background=color;
  line.style.transform="rotate("+Math.atan2(y2-y1,x2-x1)+"rad)";
  board.appendChild(line);
}

document.querySelectorAll(".terminal").forEach(t=>{
  t.addEventListener("click",()=>{
    t.classList.add("selected");
    selected.push(t);

    if(selected.length===2){
      const a=selected[0];
      const b=selected[1];

      if(!a.dataset.jb && !b.dataset.jb){
        show("âŒ å™¨å…·åŒå£«ã¯æ¥ç¶šä¸å¯");
      }else{
        union(a.dataset.id,b.dataset.id);
        drawLine(a,b);
      }

      selected.forEach(x=>x.classList.remove("selected"));
      selected=[];
    }
  });
});

function analyze(){
  show("");
  document.getElementById("answer").innerText="";

  union("SW1","SW2");

  if(find("L")===find("N")){
    show("ğŸ”¥ L-Nã‚·ãƒ§ãƒ¼ãƒˆï¼");
    return;
  }

  let visited=new Set();
  function dfs(n){
    if(visited.has(n)) return;
    visited.add(n);
    connections[n].forEach(dfs);
  }

  dfs("L");

  if(!visited.has("Lamp1")){
    show("âŒ Lã‹ã‚‰ãƒ©ãƒ³ãƒ—é»’ã¸åˆ°é”ã§ããªã„");
    showAnswer();
    return;
  }

  visited.clear();
  dfs("Lamp2");

  if(!visited.has("N")){
    show("âŒ ãƒ©ãƒ³ãƒ—ç™½ã‹ã‚‰Nã¸æˆ»ã‚Œãªã„");
    showAnswer();
    return;
  }

  show("ğŸ’¡ æ­£è§£ï¼å›è·¯æˆç«‹ï¼");
}

function show(msg){
  document.getElementById("message").innerText=msg;
}

function showAnswer(){
  document.getElementById("answer").innerText=
  "ã€æ­£è§£ä¾‹ã€‘\n"+
  "Lâ†’SW1\n"+
  "SW2â†’ãƒ©ãƒ³ãƒ—é»’\n"+
  "ãƒ©ãƒ³ãƒ—ç™½â†’N\n"+
  "JBå†…ã§3æœ¬ãšã¤æŸã­";
}

function resetGame(){
  selected=[];
  show("");
  document.getElementById("answer").innerText="";
  init();
}

</script>
</body>
</html>
