<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è¤‡ç·šå›³ãƒ¢ãƒ¼ãƒ‰ - æœ¬ç‰©è§£æ</title>

<style>
body{
  text-align:center;
  font-family:sans-serif;
  background:#f0f0f0;
  margin:0;
}

#board{
  width:360px;
  height:500px;
  margin:20px auto;
  background:white;
  border:2px solid black;
  position:relative;
}

.node{
  width:80px;
  height:40px;
  border:2px solid black;
  text-align:center;
  line-height:40px;
  position:absolute;
  background:#ddd;
}

.terminal{
  width:18px;
  height:18px;
  border-radius:50%;
  background:black;
  position:absolute;
  cursor:pointer;
}

.selected{
  background:red !important;
}

.jb{
  width:120px;
  height:120px;
  border:3px solid #333;
  position:absolute;
  top:190px;
  left:120px;
  background:#fafafa;
}

.line{
  position:absolute;
  background:black;
  height:3px;
  transform-origin:0 0;
}

#message{
  font-size:20px;
  font-weight:bold;
  margin-top:10px;
}
</style>
</head>

<body>

<h2>âš¡ è¤‡ç·šå›³ãƒ¢ãƒ¼ãƒ‰ - æœ¬ç‰©è§£æ</h2>

<div id="board">

  <div class="node" style="top:40px; left:20px;">é›»æº</div>
  <div class="terminal" data-id="L" style="top:90px; left:50px;"></div>
  <div class="terminal" data-id="N" style="top:120px; left:50px;"></div>

  <div class="node" style="top:40px; left:250px;">SW</div>
  <div class="terminal" data-id="SW1" style="top:90px; left:280px;"></div>
  <div class="terminal" data-id="SW2" style="top:120px; left:280px;"></div>

  <div class="node" style="top:400px; left:140px;">ãƒ©ãƒ³ãƒ—</div>
  <div class="terminal" data-id="Lamp1" style="top:360px; left:165px;"></div>
  <div class="terminal" data-id="Lamp2" style="top:360px; left:195px;"></div>

  <div class="jb"></div>

  <div class="terminal" data-id="JB1" style="top:210px; left:140px;"></div>
  <div class="terminal" data-id="JB2" style="top:210px; left:190px;"></div>
  <div class="terminal" data-id="JB3" style="top:210px; left:240px;"></div>
  <div class="terminal" data-id="JB4" style="top:260px; left:140px;"></div>
  <div class="terminal" data-id="JB5" style="top:260px; left:190px;"></div>
  <div class="terminal" data-id="JB6" style="top:260px; left:240px;"></div>

</div>

<button onclick="bundle()">æŸã­ã‚‹</button>
<button onclick="analyze()">è§£æ</button>
<button onclick="resetGame()">ãƒªã‚»ãƒƒãƒˆ</button>

<div id="message"></div>

<script>

let selectedTerminals=[];
let lines=[];
let parent={};

function init(){
  parent={};
  document.querySelectorAll(".terminal").forEach(t=>{
    parent[t.dataset.id]=t.dataset.id;
  });
}
init();

function find(x){
  if(parent[x]!==x){
    parent[x]=find(parent[x]);
  }
  return parent[x];
}

function union(a,b){
  let pa=find(a);
  let pb=find(b);
  if(pa!==pb){
    parent[pb]=pa;
  }
}

document.querySelectorAll(".terminal").forEach(t=>{
  t.addEventListener("click",()=>{
    if(selectedTerminals.includes(t)){
      t.classList.remove("selected");
      selectedTerminals=selectedTerminals.filter(x=>x!==t);
    }else{
      t.classList.add("selected");
      selectedTerminals.push(t);
    }
  });
});

function bundle(){
  if(selectedTerminals.length<2) return;
  let first=selectedTerminals[0].dataset.id;
  selectedTerminals.forEach(t=>{
    union(first,t.dataset.id);
    t.classList.remove("selected");
  });
  selectedTerminals=[];
}

function analyze(){
  let message=document.getElementById("message");

  // ã‚·ãƒ§ãƒ¼ãƒˆåˆ¤å®š
  if(find("L")===find("N")){
    message.innerText="ğŸ”¥ ã‚·ãƒ§ãƒ¼ãƒˆç™ºç”Ÿï¼æ¬ é™¥ï¼";
    return;
  }

  // æ­£å¸¸å›è·¯åˆ¤å®š
  if(
    find("L")===find("SW1") &&
    find("SW2")===find("Lamp1") &&
    find("Lamp2")===find("N")
  ){
    message.innerText="ğŸ’¡ æ­£è§£ï¼ãƒ©ãƒ³ãƒ—ç‚¹ç¯ï¼";
  }else{
    message.innerText="âŒ å›è·¯ä¸æˆç«‹";
  }
}

function resetGame(){
  document.getElementById("message").innerText="";
  selectedTerminals=[];
  document.querySelectorAll(".terminal").forEach(t=>t.classList.remove("selected"));
  init();
}

</script>

</body>
</html>
