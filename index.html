<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è¤‡ç·šå›³ãƒ¢ãƒ¼ãƒ‰ - çµç·šè¡¨ç¤ºç‰ˆ</title>
<style>
body{ text-align:center; font-family:sans-serif; background:#f0f0f0; margin:0; }
#board{ width:360px;height:500px;margin:20px auto;background:white;border:2px solid black;position:relative; }

.node{ width:80px;height:40px;border:2px solid black;text-align:center;line-height:40px;position:absolute;background:#ddd; }

.terminal{
  width:18px;height:18px;border-radius:50%;
  position:absolute;cursor:pointer;border:2px solid #333;
}

.black{ background:black; }
.white{ background:white; }

.selected{ outline:3px solid red; }

.jb{ width:120px;height:120px;border:3px solid #333;position:absolute;top:190px;left:120px;background:#fafafa; }

.line{
  position:absolute;
  height:3px;
  background:black;
  transform-origin:0 0;
}

#message{ font-size:20px;font-weight:bold;margin-top:10px; }
#answer{ font-size:14px;margin-top:6px;color:#333; }
button{ margin:4px;padding:6px 10px; }
</style>
</head>
<body>

<h2>âš¡ è¤‡ç·šå›³ãƒ¢ãƒ¼ãƒ‰ - çµç·šè¡¨ç¤ºç‰ˆ</h2>

<div id="board">

<div class="node" style="top:40px; left:20px;">é›»æº</div>
<div class="terminal black" data-id="L" style="top:90px; left:50px;"></div>
<div class="terminal white" data-id="N" style="top:120px; left:50px;"></div>

<div class="node" style="top:40px; left:250px;">SW</div>
<div class="terminal black" data-id="SW1" style="top:90px; left:280px;"></div>
<div class="terminal black" data-id="SW2" style="top:120px; left:280px;"></div>

<div class="node" style="top:400px; left:140px;">ãƒ©ãƒ³ãƒ—</div>
<div class="terminal black" data-id="Lamp1" style="top:360px; left:165px;"></div>
<div class="terminal white" data-id="Lamp2" style="top:360px; left:195px;"></div>

<div class="jb"></div>

<div class="terminal black" data-id="JB1" style="top:210px; left:140px;"></div>
<div class="terminal black" data-id="JB2" style="top:210px; left:190px;"></div>
<div class="terminal black" data-id="JB3" style="top:210px; left:240px;"></div>
<div class="terminal black" data-id="JB4" style="top:260px; left:140px;"></div>
<div class="terminal black" data-id="JB5" style="top:260px; left:190px;"></div>
<div class="terminal black" data-id="JB6" style="top:260px; left:240px;"></div>

</div>

<button onclick="bundle()">æŸã­ã‚‹</button>
<button onclick="analyze()">è§£æï¼ˆSW ONï¼‰</button>
<button onclick="resetGame()">ãƒªã‚»ãƒƒãƒˆ</button>

<div id="message"></div>
<div id="answer"></div>

<script>

let selected=[];
let parent={};
const board=document.getElementById("board");

function init(){
  parent={};
  document.querySelectorAll(".terminal").forEach(t=>{
    parent[t.dataset.id]=t.dataset.id;
    t.classList.remove("selected");
  });
  document.querySelectorAll(".line").forEach(l=>l.remove());
}
init();

function find(x){
  if(parent[x]!==x) parent[x]=find(parent[x]);
  return parent[x];
}

function union(a,b){
  let pa=find(a);
  let pb=find(b);
  if(pa!==pb) parent[pb]=pa;
}

document.querySelectorAll(".terminal").forEach(t=>{
  t.addEventListener("click",()=>{
    if(selected.includes(t)){
      t.classList.remove("selected");
      selected=selected.filter(x=>x!==t);
    }else{
      t.classList.add("selected");
      selected.push(t);
    }
  });
});

function drawLine(a,b){
  const ra=a.getBoundingClientRect();
  const rb=b.getBoundingClientRect();
  const rBoard=board.getBoundingClientRect();

  const x1=ra.left-rBoard.left+9;
  const y1=ra.top-rBoard.top+9;
  const x2=rb.left-rBoard.left+9;
  const y2=rb.top-rBoard.top+9;

  const len=Math.hypot(x2-x1,y2-y1);

  const line=document.createElement("div");
  line.className="line";
  line.style.left=x1+"px";
  line.style.top=y1+"px";
  line.style.width=len+"px";
  line.style.transform="rotate("+Math.atan2(y2-y1,x2-x1)+"rad)";
  board.appendChild(line);
}

function bundle(){
  if(selected.length<2) return;

  const base=selected[0];

  for(let i=1;i<selected.length;i++){
    union(base.dataset.id, selected[i].dataset.id);
    drawLine(base, selected[i]);
  }

  selected.forEach(t=>t.classList.remove("selected"));
  selected=[];
}

function analyze(){
  const msg=document.getElementById("message");
  const ans=document.getElementById("answer");
  msg.innerText="";
  ans.innerText="";

  union("SW1","SW2");

  if(find("L")===find("N")){
    msg.innerText="ğŸ”¥ L-Nã‚·ãƒ§ãƒ¼ãƒˆï¼";
    return;
  }

  if(
    find("L")===find("SW1") &&
    find("SW2")===find("Lamp1") &&
    find("Lamp2")===find("N")
  ){
    msg.innerText="ğŸ’¡ æ­£è§£ï¼å›è·¯æˆç«‹ï¼";
  }else{
    msg.innerText="âŒ å›è·¯ä¸æˆç«‹";
    ans.innerText="æ­£è§£ä¾‹ï¼š\nLâ†’SW1\nSW2â†’ãƒ©ãƒ³ãƒ—é»’\nãƒ©ãƒ³ãƒ—ç™½â†’N";
  }
}

function resetGame(){
  document.getElementById("message").innerText="";
  document.getElementById("answer").innerText="";
  selected=[];
  init();
}

</script>
</body>
</html>
