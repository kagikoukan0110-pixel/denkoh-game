<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é›»å·¥ãƒ‘ã‚ºãƒ« - è¤‡ç·šå›³ãƒ¢ãƒ¼ãƒ‰</title>

<style>
body {
  text-align:center;
  font-family:sans-serif;
  background:#f0f0f0;
  margin:0;
}

#board {
  width:340px;
  height:400px;
  margin:20px auto;
  background:white;
  border:2px solid black;
  position:relative;
}

.node {
  width:60px;
  height:40px;
  border:2px solid black;
  position:absolute;
  text-align:center;
  line-height:40px;
  font-weight:bold;
  background:#ddd;
}

.terminal {
  width:18px;
  height:18px;
  border-radius:50%;
  background:black;
  position:absolute;
  cursor:pointer;
}

.line {
  position:absolute;
  background:black;
  height:3px;
  transform-origin:0 0;
}

.selected {
  background:red !important;
}

#score {
  font-size:18px;
  margin-top:10px;
}

#message {
  font-size:20px;
  font-weight:bold;
  margin-top:10px;
}
</style>
</head>

<body>

<h2>âš¡ è¤‡ç·šå›³ãƒ¢ãƒ¼ãƒ‰ - å˜æ¥µã‚¹ã‚¤ãƒƒãƒ</h2>

<div id="board">

  <!-- é›»æº -->
  <div class="node" style="top:30px; left:20px;">é›»æº</div>
  <div class="terminal" data-id="L" style="top:80px; left:45px;"></div>
  <div class="terminal" data-id="N" style="top:110px; left:45px;"></div>

  <!-- ã‚¹ã‚¤ãƒƒãƒ -->
  <div class="node" style="top:180px; left:140px;">SW</div>
  <div class="terminal" data-id="SW1" style="top:230px; left:165px;"></div>
  <div class="terminal" data-id="SW2" style="top:230px; left:195px;"></div>

  <!-- ãƒ©ãƒ³ãƒ— -->
  <div class="node" style="top:30px; left:230px;">ãƒ©ãƒ³ãƒ—</div>
  <div class="terminal" data-id="Lamp1" style="top:80px; left:255px;"></div>
  <div class="terminal" data-id="Lamp2" style="top:110px; left:255px;"></div>

</div>

<div id="score">ã‚¹ã‚³ã‚¢: 10000</div>
<div id="message"></div>
<button onclick="resetGame()">ãƒªã‚»ãƒƒãƒˆ</button>

<script>

let selected = null;
let connections = [];
let score = 10000;

const correctConnections = [
  ["L","SW1"],
  ["SW2","Lamp1"],
  ["N","Lamp2"]
];

const terminals = document.querySelectorAll(".terminal");
const board = document.getElementById("board");
const scoreDisplay = document.getElementById("score");
const message = document.getElementById("message");

terminals.forEach(t => {
  t.addEventListener("click", () => handleClick(t));
});

function handleClick(t) {
  if (!selected) {
    selected = t;
    t.classList.add("selected");
  } else {
    if (selected === t) return;

    createLine(selected, t);
    checkConnection(selected.dataset.id, t.dataset.id);

    selected.classList.remove("selected");
    selected = null;
  }
}

function createLine(a, b) {
  let rectA = a.getBoundingClientRect();
  let rectB = b.getBoundingClientRect();
  let rectBoard = board.getBoundingClientRect();

  let x1 = rectA.left - rectBoard.left + 9;
  let y1 = rectA.top - rectBoard.top + 9;
  let x2 = rectB.left - rectBoard.left + 9;
  let y2 = rectB.top - rectBoard.top + 9;

  let length = Math.hypot(x2-x1, y2-y1);

  let line = document.createElement("div");
  line.className = "line";
  line.style.left = x1 + "px";
  line.style.top = y1 + "px";
  line.style.width = length + "px";
  line.style.transform =
    "rotate(" + Math.atan2(y2-y1, x2-x1) + "rad)";
  board.appendChild(line);
}

function checkConnection(a, b) {
  let match = correctConnections.some(pair =>
    (pair[0]===a && pair[1]===b) ||
    (pair[0]===b && pair[1]===a)
  );

  if (!match) {
    score -= 2000;
  } else {
    connections.push([a,b]);
  }

  scoreDisplay.innerText = "ã‚¹ã‚³ã‚¢: " + score;

  if (connections.length === correctConnections.length) {
    message.innerText = "ğŸ’¡ æ­£è§£ï¼ãƒ©ãƒ³ãƒ—ç‚¹ç¯ï¼";
  }
}

function resetGame() {
  document.querySelectorAll(".line").forEach(l=>l.remove());
  connections = [];
  score = 10000;
  scoreDisplay.innerText = "ã‚¹ã‚³ã‚¢: 10000";
  message.innerText = "";
}

</script>

</body>
</html>
