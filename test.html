<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>電工ラボ iPhone β - 貴電監修</title>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont;
  background:#f4f1ea;
  overflow:hidden;
}

header{
  background:#1e88e5;
  color:white;
  padding:10px;
  display:flex;
  justify-content:space-between;
  font-size:14px;
}

#boardContainer{
  position:relative;
  height:65vh;
  background:#f4f1ea;
  touch-action:none;
}

svg{
  width:100%;
  height:100%;
}

footer{
  position:fixed;
  bottom:0;
  width:100%;
  background:white;
  border-top:1px solid #ccc;
  display:flex;
  justify-content:space-around;
  padding:10px 0;
}

button{
  font-size:14px;
  padding:8px 12px;
}

.active{
  background:#1e88e5;
  color:white;
}

.lamp-on{
  fill:#ffcc00 !important;
}

.highlight{
  stroke:red !important;
  stroke-width:4;
}
</style>
</head>

<body>

<header>
  <div>問題01</div>
  <div id="timer">40:00</div>
</header>

<div id="boardContainer">
<svg viewBox="0 0 800 500" id="board">

  <rect id="breaker" x="80" y="80" width="60" height="80" fill="#ccc" stroke="#999"/>
  <rect id="switch" x="300" y="150" width="60" height="80" fill="#fafafa" stroke="#999"/>
  <rect id="box" x="300" y="320" width="100" height="70" fill="#fff" stroke="#999"/>
  <circle id="lamp" cx="650" cy="190" r="20" fill="#666"/>

</svg>
</div>

<footer>
  <button onclick="setMode('wire')" id="wireBtn" class="active">配線</button>
  <button onclick="setMode('crimp')" id="crimpBtn">圧着</button>
  <button onclick="submitExam()">確認</button>
</footer>

<script>
let mode="wire";
let breakerOn=false;
let connected=false;
let crimped=false;
let scale=1;
let startDist=0;

function setMode(m){
  mode=m;
  document.getElementById("wireBtn").classList.remove("active");
  document.getElementById("crimpBtn").classList.remove("active");
  document.getElementById(m+"Btn").classList.add("active");
}

document.getElementById("breaker").addEventListener("click",()=>{
  breakerOn=!breakerOn;
  document.getElementById("breaker")
    .setAttribute("fill",breakerOn?"#4caf50":"#ccc");
  updateLamp();
});

document.getElementById("switch").addEventListener("click",()=>{
  if(mode!=="wire") return;
  connected=!connected;
  updateLamp();
});

document.getElementById("box").addEventListener("click",()=>{
  if(mode!=="crimp") return;
  crimped=true;
  alert("圧着完了");
  updateLamp();
});

function updateLamp(){
  const lamp=document.getElementById("lamp");
  if(breakerOn && connected && crimped){
    lamp.classList.add("lamp-on");
  }else{
    lamp.classList.remove("lamp-on");
  }
}

function submitExam(){
  let score=100;
  let errors=[];
  if(!breakerOn){score-=10;errors.push("ブレーカー未投入")}
  if(!connected){score-=20;errors.push("配線未接続")}
  if(!crimped){score-=20;errors.push("圧着未実施")}

  const pass=score>=60;

  showResult(score,pass,errors);
}

function showResult(score,pass,errors){
  alert((pass?"合格":"不合格")+"\n"+score+"点\n"+errors.join("\n"));
}

/* ピンチズーム */
const board=document.getElementById("board");
document.getElementById("boardContainer").addEventListener("touchmove",(e)=>{
  if(e.touches.length===2){
    const dx=e.touches[0].clientX-e.touches[1].clientX;
    const dy=e.touches[0].clientY-e.touches[1].clientY;
    const dist=Math.sqrt(dx*dx+dy*dy);
    if(startDist){
      scale*=dist/startDist;
      board.style.transform=`scale(${scale})`;
    }
    startDist=dist;
  }
});
document.getElementById("boardContainer").addEventListener("touchend",()=>{
  startDist=0;
});
</script>

</body>
</html>
