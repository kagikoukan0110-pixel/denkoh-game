<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>電工ラボ β - 貴電監修</title>

<style>
body {
  margin:0;
  font-family:sans-serif;
  background:#d7ccc8;
}

header {
  background:#1e88e5;
  color:white;
  padding:10px 20px;
  display:flex;
  justify-content:space-between;
}

#board {
  background:#f4f1ea;
  margin:20px auto;
  display:block;
  border-radius:8px;
  box-shadow:0 20px 40px rgba(0,0,0,0.3);
}

button {
  padding:6px 12px;
  margin-right:6px;
}

#controls {
  padding:10px;
  text-align:center;
}

.lamp-on {
  fill:#ffcc00 !important;
}

.resultOverlay {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.6);
  display:flex;
  justify-content:center;
  align-items:center;
}

.resultCard {
  background:white;
  padding:40px;
  border-radius:10px;
  text-align:center;
}
</style>
</head>

<body>

<header>
  <div>電工ラボ β（貴電監修）</div>
  <div id="stepLabel">STEP: 材料確認</div>
</header>

<div id="controls">
  <button onclick="nextStep()">次工程</button>
  <button onclick="toggleBreaker()">ブレーカー</button>
  <button onclick="connectSwitch()">スイッチ切替</button>
  <button onclick="applyCrimp()">圧着</button>
  <button onclick="submitExam()">採点</button>
</div>

<svg id="board" width="800" height="500" viewBox="0 0 800 500">

  <!-- ブレーカー -->
  <rect id="breaker" x="60" y="80" width="60" height="80" fill="#ccc" stroke="#999"/>
  <text x="65" y="70" font-size="12">BR</text>

  <!-- スイッチ -->
  <rect id="switch1" x="200" y="150" width="60" height="80" fill="#fafafa" stroke="#999"/>
  <rect id="switch2" x="400" y="150" width="60" height="80" fill="#fafafa" stroke="#999"/>

  <!-- BOX -->
  <rect id="box" x="300" y="300" width="100" height="80" fill="#fff" stroke="#999"/>

  <!-- ランプ -->
  <circle id="lamp" cx="650" cy="190" r="20" fill="#666"/>
</svg>

<script>
let breakerOn = false;
let switchState = 0;
let crimpDone = false;
let stepIndex = 0;

const steps = [
  "材料確認",
  "器具配置",
  "圧着",
  "接続",
  "確認"
];

function nextStep(){
  if(stepIndex < steps.length-1){
    stepIndex++;
    document.getElementById("stepLabel").textContent = "STEP: " + steps[stepIndex];
  }
}

function toggleBreaker(){
  breakerOn = !breakerOn;
  document.getElementById("breaker")
    .setAttribute("fill", breakerOn ? "#4caf50" : "#ccc");
  updateLamp();
}

function connectSwitch(){
  switchState = switchState === 0 ? 1 : 0;
  updateLamp();
}

function applyCrimp(){
  if(stepIndex !== 2){
    alert("圧着工程ではありません");
    return;
  }
  crimpDone = true;
  alert("圧着完了");
}

function updateLamp(){

  const lamp = document.getElementById("lamp");

  if(breakerOn && switchState === 1 && crimpDone){
    lamp.classList.add("lamp-on");
  } else {
    lamp.classList.remove("lamp-on");
  }
}

function submitExam(){

  let score = 100;
  let reasons = [];

  if(!breakerOn){
    score -= 10;
    reasons.push("ブレーカー未投入");
  }

  if(!crimpDone){
    score -= 20;
    reasons.push("圧着未実施");
  }

  if(switchState !== 1){
    score -= 10;
    reasons.push("スイッチ不適切");
  }

  const pass = score >= 60;

  showResult(score, pass, reasons);
}

function showResult(score, pass, reasons){

  const overlay = document.createElement("div");
  overlay.className = "resultOverlay";

  overlay.innerHTML = `
    <div class="resultCard">
      <h1>${pass ? "合格" : "不合格"}</h1>
      <h2>${score}点</h2>
      <p>${reasons.join("<br>")}</p>
      <button onclick="location.reload()">もう一度</button>
    </div>
  `;

  document.body.appendChild(overlay);
}
</script>

</body>
</html>
