:root{
  --bg:#000;
  --panel:#e6e6e6;
  --term-bg:#222;
  --wire-black:#0b0b0b;
  --wire-white:#ffffff;
  --wire-red:#d82b2b;
  --device-w:170px; /* base width (will scale per data-scale) */
  --device-scale:0.8; /* overall shrink (20%) */
  --term-size:36px;
  --hp-green:#34d058;
  --boss-red:#e74c3c;
  --accent:#ffd200;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN",Meiryo,sans-serif;color:#fff}
#hdr{display:flex;align-items:flex-start;gap:12px;padding:18px 16px}
#brand{font-weight:800;font-size:26px}
#meta{flex:1}
#worldLabel{font-size:14px;color:#ccc;margin-bottom:8px}
#hpWrap{width:70%;height:14px;background:#222;border-radius:12px;overflow:hidden}
#playerHP{height:100%;width:100%;background:var(--hp-green);border-radius:12px}
#stateLabel{font-size:12px;color:#aaa;margin-top:6px}

/* board */
#board{position:relative;height:calc(100vh - 220px);padding:8px 6px;overflow:auto}
canvas#wireCanvas{position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:30}

/* device common */
.device{
  position:absolute;
  width:var(--device-w);
  padding:14px;
  transform:translate(-50%,-50%) scale(var(--device-scale));
  background:var(--panel);
  color:#000;border-radius:18px;
  box-shadow:0 12px 30px rgba(0,0,0,0.5);
  text-align:center;z-index:40;
  user-select:none;
}

/* positions chosen to avoid overlap (fixed for reliability on mobile) */
#power{left:50%;top:12%}
#switch1{left:20%;top:36%}
#jb{left:52%;top:36%}
#lamp1{left:52%;top:63%}

/* individual styling */
.device-power .breaker{width:56px;height:28px;background:#333;margin:6px auto;border-radius:6px;display:flex;align-items:center;justify-content:center}
.device-power .termRow{display:flex;gap:18px;justify-content:center;margin-top:8px}
.device-switch{background:#eaffef}
.device-switch .switchState{font-size:13px;color:#333;margin-top:8px}
.device-jb .jb-row{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;align-items:center;padding-top:6px}
.device-jb .jbLabel{position:absolute;left:50%;top:8px;transform:translateX(-50%);font-weight:700;color:#fff;opacity:0.5}

/* lamp specifics */
.device-lamp .lampIcon{width:48px;height:48px;border-radius:50%;background:linear-gradient(#fff,#eee);margin:0 auto 8px;box-shadow:inset 0 2px 8px rgba(0,0,0,0.12)}
.device-lamp .lamp-term-row{display:flex;gap:22px;justify-content:center}

/* terminal styling (small uniform) */
.terminal{
  width:var(--term-size);
  height:var(--term-size);
  border-radius:50%;
  background:var(--term-bg);
  color:#fff;font-weight:700;display:flex;align-items:center;justify-content:center;
  font-size:14px;cursor:pointer;box-shadow:0 6px 10px rgba(0,0,0,0.4);z-index:60
}
.terminal.small{width:30px;height:30px;font-size:12px}

/* controls footer */
#controls{position:fixed;left:0;right:0;bottom:20px;display:flex;justify-content:center;gap:18px;z-index:80}
.ctrl{border-radius:30px;padding:14px 26px;border:none;font-weight:800;box-shadow:0 8px 18px rgba(0,0,0,0.5)}
.ctrl.small{padding:10px 16px}
.ctrl.big{background:var(--accent);color:#000}
#setBtn{background:var(--accent);color:#000}

/* modal */
.modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:200;pointer-events:auto}
.modal.hidden{display:none}
.modalBox{background:rgba(0,0,0,0.9);padding:20px;border-radius:12px;max-width:88%;width:92%;color:#fff}
.options{display:flex;flex-direction:column;gap:10px;margin-top:12px}
.option{padding:10px;border-radius:10px;background:#111;border:1px solid rgba(255,255,255,0.04);cursor:pointer}
.option.chosen{background:#0b84ff;color:#fff}

/* boss */
#bossOverlay .modalBox{width:92%;max-width:720px;display:flex;gap:12px}
#bossImg{width:140px;height:140px;object-fit:contain;border-radius:8px}
#bossHPWrap{height:14px;background:#2b1818;border-radius:12px;overflow:hidden;margin-top:12px}
#bossHP{height:100%;width:100%;background:var(--boss-red);transition:width 700ms ease}
#hitText{position:absolute;top:10%;left:50%;transform:translateX(-50%);font-size:46px;color:#fff;z-index:300;display:none}

/* explosion */
#explosion{position:fixed;left:50%;top:40%;transform:translate(-50%,-50%) scale(0.01);width:280px;height:280px;border-radius:50%;pointer-events:none;z-index:400;display:none;background:radial-gradient(circle at 50% 50%, rgba(255,230,120,0.95) 0%, rgba(255,140,20,0.9) 30%, rgba(220,40,10,0.85) 60%, rgba(0,0,0,0) 70%)}

/* defeat dialog */
#defeatDialog{position:fixed;left:50%;top:62%;transform:translate(-50%,-50%);z-index:450;display:none;padding:18px 22px;border-radius:12px;background:rgba(0,0,0,0.85);color:var(--accent);font-weight:800;font-size:18px}

/* responsiveness: ensure smaller devices scale down things */
@media (max-width:420px){
  :root{--device-w:140px;--term-size:32px;--device-scale:0.86}
  #board{height:calc(100vh - 200px)}
}
