:root{
  --bg:#000;
  --panel:#e6e6e6;
  --term-bg:#222;
  --wire:#ffd800;
  --wirew:6;
  --device-w:77px; /* 20% down */
  --device-padding:8px;
  --boss-hp-color:#e74c3c;
  --boss-hp-back:#2b1818;
  --lamp-glow: rgba(255,220,80,0.95);
  --quiz-chosen-bg:#ffd900;
  --quiz-chosen-color:#000;
}
html,body{height:100%;margin:0;background:var(--bg);color:#fff;font-family:system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; -webkit-font-smoothing:antialiased}
#wireLayer{position:fixed;top:0;left:0;width:100vw;height:100vh;pointer-events:none;z-index:3000}

/* header */
.header{display:flex;align-items:center;justify-content:space-between;padding:12px 18px}
.title{font-size:20px;margin:0;font-weight:700}
.hp-area{width:46%;min-width:180px}
.bar{width:100%;height:12px;background:#222;border-radius:12px;overflow:hidden}
.player{height:100%;width:100%;background:#34d058;border-radius:12px}

/* board */
#board-wrap{position:relative;width:100%;height:calc(100vh - 240px);box-sizing:border-box;padding:8px 16px;overflow:hidden}
#board{position:relative;width:100%;height:100%}

/* devices */
.device{position:absolute;width:var(--device-w);padding:var(--device-padding);background:var(--panel);border-radius:12px;color:#000;box-shadow:0 12px 30px rgba(0,0,0,0.5);transform:translate(-50%,-50%);text-align:center;z-index:60;overflow:visible}
.device h3{margin:6px 0 8px 0;font-size:12px}
/* terminal reduced a bit to match smaller device size */
.terminal{display:inline-flex;justify-content:center;align-items:center;width:24px;height:24px;margin:4px;background:var(--term-bg);color:#fff;border-radius:50%;font-size:12px;cursor:pointer;user-select:none}
.selected{outline:3px solid #ffd800}

/* quiz options visual */
.quizOpt{padding:10px;border-radius:8px;border:2px solid rgba(255,255,255,0.06);background:transparent;color:#fff;text-align:left}
.quizOpt.chosen{background:var(--quiz-chosen-bg);color:var(--quiz-chosen-color);border-color:#000;font-weight:700}

/* icons */
.device .icon{width:48px;height:48px;display:block;margin:6px auto}
.icon svg{width:100%;height:100%}

/* junction */
#junction{left:40%;top:42%;width:124px;padding:12px;background:#d6d6d6;border-radius:14px;z-index:70;transform:translate(-50%,-50%)}
.jb-dots{display:flex;flex-wrap:wrap;justify-content:center;gap:8px}
.jb-term{width:18px;height:18px;border-radius:50%;background:#222;display:inline-block;cursor:pointer}

/* controls */
.controls{height:180px;padding:12px 18px;box-sizing:border-box;display:flex;flex-direction:column;align-items:center;justify-content:flex-start}
button#setBtn{padding:14px 36px;border-radius:26px;border:none;background:#ffd000;color:#000;font-weight:700}
button.small{padding:8px 12px;margin:8px;border-radius:12px;border:none;background:#333;color:#fff}
.note{font-size:13px;color:#bbb;text-align:center;margin-top:8px}

/* modal and screens */
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.75);display:none;align-items:flex-start;justify-content:center;flex-direction:column;padding:36px;z-index:9500;pointer-events:auto}
.modal-backdrop.show{display:flex}
.titleBig{font-size:40px;color:#ffd200;font-weight:800;margin-bottom:12px}
.quizBox{background:#111;padding:18px;border-radius:12px;max-width:760px;color:#fff}

/* boss panel & damage */
#bossScreen{position:fixed;inset:0;display:none;align-items:center;justify-content:center;flex-direction:column;z-index:9200;color:#fff}
#bossPanel{width:86%;max-width:820px;background:#0d0d0d;border-radius:14px;padding:18px;box-shadow:0 20px 60px rgba(0,0,0,0.7);display:flex;gap:18px;align-items:center;transform-origin:center center}
#bossImg{width:220px;height:220px;object-fit:cover;border-radius:8px;background:linear-gradient(180deg,#222,#111);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:18px}
#bossName{font-size:20px;color:#ffd200;margin-right:12px;font-weight:800;white-space:nowrap}
.bossHPwrap{flex:1}
.bossHPback{width:100%;height:18px;background:var(--boss-hp-back);border-radius:12px;overflow:hidden}
.bossHPbar{height:100%;width:100%;background:var(--boss-hp-color);transition:width 700ms ease;border-radius:12px}

/* hit text */
#hitText{position:absolute;top:8%;left:50%;transform:translateX(-50%);font-size:56px;color:#fff;z-index:9300;display:none;text-shadow:0 6px 18px rgba(0,0,0,0.6);font-weight:900}

/* animations */
@keyframes flashRed { 0%{filter:none;opacity:1}25%{filter:drop-shadow(0 0 30px rgba(231,76,60,0.98));opacity:1}50%{filter:none;opacity:0.95}75%{filter:drop-shadow(0 0 30px rgba(231,76,60,0.98));opacity:1}100%{filter:none;opacity:1} }
@keyframes shakeStrong { 0%{transform:translateX(0)}10%{transform:translateX(-18px)}20%{transform:translateX(18px)}30%{transform:translateX(-14px)}40%{transform:translateX(14px)}50%{transform:translateX(-8px)}60%{transform:translateX(8px)}70%{transform:translateX(-4px)}80%{transform:translateX(4px)}100%{transform:translateX(0)} }
.boss-damage{animation: flashRed 360ms ease-in-out 0s 6 both, shakeStrong 420ms ease-in-out 0s 4 both}
@keyframes bodyShake { 0%{transform:none}10%{transform:translate(6px,4px) rotate(-0.8deg)}20%{transform:translate(-6px,-3px) rotate(0.6deg)}30%{transform:translate(8px,-6px) rotate(-1deg)}40%{transform:translate(-8px,6px) rotate(0.8deg)}50%{transform:none}100%{transform:none} }
.body-shake{animation: bodyShake 700ms ease-in-out}

/* explosion, particles, flash (same as before) */
#explosion{position:fixed;left:50%;top:40%;transform:translate(-50%,-50%) scale(0.01);width:360px;height:360px;border-radius:50%;pointer-events:none;z-index:9400;display:none;background:radial-gradient(circle at 50% 50%, rgba(255,250,200,0.95) 0%, rgba(255,180,60,0.92) 30%, rgba(220,60,10,0.9) 60%, rgba(0,0,0,0) 72%);box-shadow:0 0 80px rgba(255,180,60,0.6)}
.particle{position:fixed;width:8px;height:8px;border-radius:50%;background:rgba(255,230,120,0.95);z-index:9450;pointer-events:none}
#defeatDialog{position:fixed;left:50%;top:62%;transform:translate(-50%,-50%);z-index:9450;display:none;padding:18px 22px;border-radius:12px;background:rgba(0,0,0,0.85);color:#ffd200;font-weight:800;font-size:20px}
#flashOverlay{position:fixed;inset:0;display:none;z-index:2147483646;background:white;opacity:0;pointer-events:none}

/* lamp lit */
.lamp .bulb-shape{transition:filter 360ms ease, transform 360ms ease}
.lamp.lit .bulb-shape{filter:drop-shadow(0 0 30px var(--lamp-glow)) saturate(1.2);transform:scale(1.05)}
.lamp .light-halo{position:absolute;left:50%;top:34%;transform:translate(-50%,-50%);width:140px;height:140px;border-radius:50%;pointer-events:none;opacity:0;transition:opacity 360ms ease}
.lamp.lit .light-halo{opacity:1;background:radial-gradient(circle at 50% 40%, rgba(255,230,120,0.95) 0%, rgba(255,200,80,0.75) 35%, rgba(255,160,20,0.25) 60%, rgba(0,0,0,0) 80%)}

/* final video overlay */
#finalVideoWrap{position:fixed;inset:0;display:none;z-index:2147483646;background:rgba(0,0,0,0.95);align-items:center;justify-content:center}
#finalVideo{position:fixed;inset:0;width:100%;height:100%;object-fit:cover;z-index:2147483647;display:block}

/* version */
#versionBadge{position:fixed;top:8px;right:8px;color:#ccc;font-size:12px;z-index:5000}

/* responsive */
@media (max-width:480px){:root{--device-w:62px;} .title{font-size:18px}}
